<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cbmpy.CBXML</title>
    
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" /> 
  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../cbmpy.html">PySCeS CBMPy</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for cbmpy.CBXML</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CBMPy: CBXML module</span>
<span class="sd">===================</span>
<span class="sd">PySCeS Constraint Based Modelling (http://cbmpy.sourceforge.net)</span>
<span class="sd">Copyright (C) 2009-2015 Brett G. Olivier, VU University Amsterdam, Amsterdam, The Netherlands</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>

<span class="sd">Author: Brett G. Olivier</span>
<span class="sd">Contact email: bgoli@users.sourceforge.net</span>
<span class="sd">Last edit: $Author: bgoli $ ($Id: CBXML.py 416 2016-02-23 16:12:23Z bgoli $)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c">## gets rid of &quot;invalid variable name&quot; info</span>
<span class="c"># pylint: disable=C0103</span>
<span class="c">## gets rid of &quot;line to long&quot; info</span>
<span class="c"># pylint: disable=C0301</span>
<span class="c">## use with caution: gets rid of module xxx has no member errors (run once enabled)</span>
<span class="c"># pylint: disable=E1101</span>

<span class="c"># preparing for Python 3 port</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="c"># all unicode literals must first be cast to string for libSBML API - brett</span>
<span class="c">#from __future__ import unicode_literals</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="c"># this is a hack that needs to be streamlined a bit</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cStringIO</span> <span class="kn">as</span> <span class="nn">csio</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">io</span> <span class="kn">as</span> <span class="nn">csio</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getuser</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ELTree</span>
<span class="kn">from</span> <span class="nn">xml.dom.minidom</span> <span class="kn">import</span> <span class="n">getDOMImplementation</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">HTMLParser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c">#from html.parser import HTMLParser</span>
    <span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">parser</span>
    <span class="n">HTMLParser</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">HTMLParser</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">CBModel</span>
<span class="c">#from .CBDataStruct import (MIRIAMannotation, MIRIAMModelAnnotation)</span>
<span class="kn">from</span> <span class="nn">.CBDataStruct</span> <span class="kn">import</span> <span class="n">MIRIAMannotation</span>
<span class="kn">from</span> <span class="nn">.CBCommon</span> <span class="kn">import</span> <span class="p">(</span><span class="n">checkChemFormula</span><span class="p">,</span> <span class="n">processSpeciesChargeChemFormulaAnnot</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.CBConfig</span> <span class="kn">import</span> <span class="n">__CBCONFIG__</span> <span class="k">as</span> <span class="n">__CBCONFIG__</span>

<span class="n">__DEBUG__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s">&#39;VERSION&#39;</span><span class="p">]</span>

<span class="n">_HAVE_SBML_</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">libsbml</span>
    <span class="n">_HAVE_SBML_</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">SBMLreader</span>  <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SBMLReader</span><span class="p">()</span>
    <span class="n">SBMLwriter</span>  <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SBMLWriter</span><span class="p">()</span>

    <span class="n">SBML_TYPES</span> <span class="o">=</span> <span class="p">{</span><span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_SPECIES</span> <span class="p">:</span> <span class="s">&#39;species&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_REACTION</span> <span class="p">:</span> <span class="s">&#39;reaction&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_COMPARTMENT</span> <span class="p">:</span> <span class="s">&#39;compartment&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_PARAMETER</span> <span class="p">:</span> <span class="s">&#39;parameter&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_INITIAL_ASSIGNMENT</span> <span class="p">:</span> <span class="s">&#39;initialassignment&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_SPECIES_REFERENCE</span> <span class="p">:</span> <span class="s">&#39;speciesreference&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_UNKNOWN</span> <span class="p">:</span> <span class="s">&#39;unknown&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_FLUXBOUND</span> <span class="p">:</span> <span class="s">&#39;fluxbound&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_OBJECTIVE</span> <span class="p">:</span> <span class="s">&#39;objective&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_FLUXOBJECTIVE</span> <span class="p">:</span> <span class="s">&#39;fluxobjective&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_GENEASSOCIATION</span> <span class="p">:</span> <span class="s">&#39;geneassociation2&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_GENEPRODUCT</span> <span class="p">:</span> <span class="s">&#39;geneproduct&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_GENEPRODUCTASSOCIATION</span> <span class="p">:</span> <span class="s">&#39;geneproductassociation&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_GENEPRODUCTREF</span> <span class="p">:</span> <span class="s">&#39;geneproductref&#39;</span><span class="p">,</span>
                  <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_FBC_V1ASSOCIATION</span> <span class="p">:</span> <span class="s">&#39;geneassociation1&#39;</span>
                  <span class="p">}</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: SBML support not available, please install libSBML, Python bindings with FBC (sbml.org)&#39;</span><span class="p">)</span>
    <span class="n">_HAVE_SBML_</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">GROUP_KINDS</span> <span class="o">=</span> <span class="p">{</span><span class="n">libsbml</span><span class="o">.</span><span class="n">GROUP_KIND_CLASSIFICATION</span> <span class="p">:</span> <span class="s">&#39;classification&#39;</span><span class="p">,</span>
                   <span class="n">libsbml</span><span class="o">.</span><span class="n">GROUP_KIND_PARTONOMY</span> <span class="p">:</span> <span class="s">&#39;partonomy&#39;</span><span class="p">,</span>
                   <span class="n">libsbml</span><span class="o">.</span><span class="n">GROUP_KIND_COLLECTION</span> <span class="p">:</span> <span class="s">&#39;collection&#39;</span><span class="p">,</span>
                   <span class="n">libsbml</span><span class="o">.</span><span class="n">GROUP_KIND_UNKNOWN</span> <span class="p">:</span> <span class="s">&#39;collection&#39;</span>
                   <span class="p">}</span>
    <span class="n">SBML_TYPES</span><span class="p">[</span><span class="s">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SBML_GROUPS_GROUP</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: SBML+GROUPS support not available, update to latest version of libSBML if required&#39;</span><span class="p">)</span>
    <span class="n">_HAVE_GROUPS_</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">_TEMP_XML_FILE_</span> <span class="o">=</span> <span class="s">&#39;_tmpxml.tmp&#39;</span>
<span class="n">FBA_NS</span> <span class="o">=</span> <span class="s">&#39;http://www.sbml.org/sbml/level3/version1/fba/version1&#39;</span>
<span class="n">METAPREFIX</span> <span class="o">=</span> <span class="s">&#39;meta_&#39;</span>


<span class="n">UNIT_DICTIONARY_L2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;area&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;metre&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
                   <span class="s">&#39;length&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;metre&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
                   <span class="s">&#39;substance&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;mole&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
                   <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
                   <span class="s">&#39;volume&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;litre&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
                   <span class="s">&#39;mmol_per_gDW_per_hr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;mole&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
                                           <span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;gram&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                                           <span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                           <span class="p">}</span>
                   <span class="p">}</span>

<span class="n">UNIT_DICTIONARY</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;hour&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>\
                            <span class="p">},</span>
                   <span class="s">&#39;mmol_per_gdw&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;mole&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
                                    <span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;gram&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                    <span class="p">},</span>
                   <span class="s">&#39;mmol_per_hour&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;mole&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">},</span>
                                     <span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                     <span class="p">},</span>
                   <span class="s">&#39;per_hour&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;exponent&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;kind&#39;</span><span class="p">:</span> <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                                   <span class="p">}</span>
                   <span class="p">}</span>
<span class="n">MODEL_UNITS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;extent&#39;</span> <span class="p">:</span> <span class="s">&#39;mmol_per_gdw&#39;</span><span class="p">,</span>
               <span class="s">&#39;substance&#39;</span> <span class="p">:</span> <span class="s">&#39;mmol_per_gdw&#39;</span><span class="p">,</span>
               <span class="s">&#39;time&#39;</span> <span class="p">:</span> <span class="s">&#39;hour&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="MLStripper"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.MLStripper">[docs]</a><span class="k">class</span> <span class="nc">MLStripper</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for stripping a string of HTML/XML used from:</span>
<span class="sd">    http://stackoverflow.com/questions/753052/strip-html-from-strings-in-python</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Strip a string of HTML/XML tags</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fed</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d_</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">d_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<span class="n">__tagStripper__</span> <span class="o">=</span> <span class="n">MLStripper</span><span class="p">()</span>

<div class="viewcode-block" id="xml_stripTags"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_stripTags">[docs]</a><span class="k">def</span> <span class="nf">xml_stripTags</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Strip a string of HTML/XML, returns a string</span>

<span class="sd">     - *html* the string containing html</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__tagStripper__</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">__tagStripper__</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="sbml_readSBML2FBA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_readSBML2FBA">[docs]</a><span class="k">def</span> <span class="nf">sbml_readSBML2FBA</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_sbml_model</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fake_boundary_species_search</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in an SBML Level 2 file with FBA annotation where and return either a CBM model object</span>
<span class="sd">    or a (cbm_mod, sbml_mod) pair if return_sbml_model=True</span>

<span class="sd">     - *fname* is the filename</span>
<span class="sd">     - *work_dir* is the working directory (only used if not None)</span>
<span class="sd">     - *return_sbml_model* [default=False] return a a (cbm_mod, sbml_mod) pair</span>
<span class="sd">     - *fake_boundary_species_search* [default=False] after looking for the boundary_condition of a species search for overloaded id&#39;s &lt;id&gt;_b</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SBML not available ... install libSBML with Python bindings for SBML support&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">readSBML</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid SBML, no model will be generated&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_sbml_model</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">D</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
    <span class="n">model_description</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNotes</span><span class="p">())</span>
    <span class="n">model_description</span> <span class="o">=</span> <span class="n">xml_stripTags</span><span class="p">(</span><span class="n">model_description</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c">#print(model_description)</span>

    <span class="n">__HAVE_FBA_ANOT__</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">ANOT</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ANOT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">__HAVE_FBA_ANOT__</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="s">&#39;&lt;fba:listOfConstraints&gt;&#39;</span> <span class="ow">in</span> <span class="n">ANOT</span><span class="p">:</span>
            <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c">#if &#39;&lt;fba:listOfObjectives/&gt;&#39; in ANOT:</span>
        <span class="k">if</span> <span class="s">&#39;&lt;fba:listOfFluxes&gt;&#39;</span> <span class="ow">in</span> <span class="n">ANOT</span><span class="p">:</span>
            <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># fix some compatability stuff</span>
        <span class="n">ANOT</span> <span class="o">=</span> <span class="n">ANOT</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;annotation&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;annotation xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot; xmlns:fba=&quot;http://www.sbml.org/sbml/level3/version1/fba/version1&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="c">#_TEMP_XML_FILE_ = createTempFileName()</span>
        <span class="c">#_TEMP_XML_FILE_ = os.path.join(work_dir, _TEMP_XML_FILE_)</span>
        <span class="c">#F = file(_TEMP_XML_FILE_,&#39;w&#39;)</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ANOT</span><span class="p">)</span>
        <span class="n">F</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#F.flush()</span>
        <span class="c">#F.close()</span>
    <span class="k">del</span> <span class="n">ANOT</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT_OBJ__</span><span class="p">:</span>
        <span class="n">__HAVE_FBA_ANOT__</span> <span class="o">=</span> <span class="bp">False</span>



    <span class="n">SPEC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumSpecies</span><span class="p">()):</span>
        <span class="n">SBSp</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">boundCon</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getBoundaryCondition</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Real boundary metabolite: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
            <span class="n">boundCon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">CF</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># chemical formula</span>
        <span class="n">CHRG</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getCharge</span><span class="p">()</span>
        <span class="c">#if CHRG == 0:</span>
            <span class="c">#CHRG = None</span>
        <span class="n">NM</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="c"># get name</span>
        <span class="c"># to strip a BiGG file see CBTools</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Species</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">boundary</span><span class="o">=</span><span class="n">boundCon</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">NM</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getInitialConcentration</span><span class="p">(),</span> <span class="n">compartment</span><span class="o">=</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getCompartment</span><span class="p">(),</span> <span class="n">charge</span><span class="o">=</span><span class="n">CHRG</span><span class="p">,</span> <span class="n">chemFormula</span><span class="o">=</span><span class="n">CF</span><span class="p">)</span>
        <span class="c"># process notes field, get rid of &lt;head&gt;, &lt;body&gt; elements</span>
        <span class="n">specNotes</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getNotes</span><span class="p">())</span>
        <span class="n">S</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readCOBRANote</span><span class="p">(</span><span class="n">specNotes</span><span class="p">)</span>

        <span class="c"># Note: chemFormula works will have to see about charge GETFROMNAME!!!</span>
        <span class="n">processSpeciesChargeChemFormulaAnnot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">getFromName</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteCharge</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c">#S.setAnnotation(&#39;note&#39;, specNotes)</span>
        <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBSp</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
        <span class="k">del</span> <span class="n">manot</span>
        <span class="n">SPEC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>

    <span class="n">boundary_species</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_species</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fake_boundary_species_search</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">INFO: No boundary species detected, if this is not what you expect try searching for boundary species using &lt;name&gt;_b (with </span><span class="se">\&quot;</span><span class="s">fake_boundary_species_search=True</span><span class="se">\&quot;</span><span class="s">)?&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumSpecies</span><span class="p">()):</span>
                <span class="n">SBSp</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">sid</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sid</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_b&#39;</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Fake boundary (_b) metabolite added: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
                    <span class="n">SPEC</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">is_boundary</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">boundary_species</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">]</span>
    <span class="n">spec_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">]</span>

    <span class="n">REAC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reactionsReversability</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumReactions</span><span class="p">()):</span>
        <span class="n">SBRe</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">R_id</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">reagents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">reactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rea</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNumReactants</span><span class="p">()):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getReactant</span><span class="p">(</span><span class="n">rea</span><span class="p">)</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
            <span class="n">stoi</span> <span class="o">=</span> <span class="o">-</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReactant</span><span class="p">(</span><span class="n">rea</span><span class="p">)</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">()</span>
            <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stoi</span><span class="p">,</span><span class="n">spec</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">boundary_species</span><span class="p">:</span>
                <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNumProducts</span><span class="p">()):</span>
            <span class="n">spec2</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getProduct</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
            <span class="n">stoi2</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getProduct</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">()</span>
            <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stoi2</span><span class="p">,</span><span class="n">spec2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">spec2</span> <span class="ow">in</span> <span class="n">boundary_species</span><span class="p">:</span>
                <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">reversible</span><span class="o">=</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReversible</span><span class="p">())</span>
        <span class="n">reactionsReversability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReversible</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reagents</span><span class="p">:</span>
            <span class="n">rgtmp</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reagent</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">R</span><span class="o">.</span><span class="n">addReagent</span><span class="p">(</span><span class="n">rgtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">[</span><span class="n">spec_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reagent_of</span><span class="p">:</span>
                <span class="n">SPEC</span><span class="p">[</span><span class="n">spec_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reagent_of</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">EXREAC</span><span class="p">:</span>
            <span class="n">R</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c">#R.setAnnotation(&#39;note&#39;, libsbml.XMLNode_convertXMLNodeToString(SBRe.getNotes()))</span>
        <span class="n">reacNotes</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNotes</span><span class="p">())</span>
        <span class="n">R</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readCOBRANote</span><span class="p">(</span><span class="n">reacNotes</span><span class="p">)</span>
        <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBRe</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">R</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
        <span class="k">del</span> <span class="n">manot</span>
        <span class="n">REAC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="n">CONSTR</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">OBJFUNCout</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">objfunc_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">__HAVE_FBA_ANOT__</span><span class="p">:</span>
        <span class="c">#root = ELTree.ElementTree(file=os.path.join(work_dir, _TEMP_XML_FILE_))</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ELTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
        <span class="n">root_i</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">getiterator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="n">root_i</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ri</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}fluxBalance&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">ri</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">rootfba</span> <span class="o">=</span> <span class="n">ELTree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span>
                <span class="n">root_fba_i</span> <span class="o">=</span> <span class="n">rootfba</span><span class="o">.</span><span class="n">getiterator</span><span class="p">()</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">root_fba_i</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}listOfConstraints&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">chld</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chld</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">))</span>
                    <span class="n">attrib</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
                        <span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="n">attrib</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">a</span><span class="p">)})</span>
                    <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}listOfObjectives&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;No objectives in listOfObjectives&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiobj</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">activeId</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">if</span> <span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}activeObjective&#39;</span> <span class="ow">in</span> <span class="n">ret</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="n">activeId</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}activeObjective&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ret</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                        <span class="c">##  print obj.attrib</span>
                        <span class="k">if</span> <span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}type&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                            <span class="n">ftype</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}type&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ftype</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="c">##  raw_input(ftype)</span>
                        <span class="n">sid</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                        <span class="c">#multiobj = []</span>
                        <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                            <span class="n">fo</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">cc_</span> <span class="ow">in</span> <span class="n">c_</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                                <span class="n">fo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cc_</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                            <span class="n">multiobj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">objfunc_data</span><span class="p">)</span>
                        <span class="n">obj_</span> <span class="o">=</span> <span class="n">multiobj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">flobj_</span> <span class="ow">in</span> <span class="n">obj_</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">flobj_</span><span class="p">:</span>
                                <span class="n">flobj_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;{http://www.sbml.org/sbml/level3/version1/fba/version1}&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="n">flobj_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">a</span><span class="p">)})</span>
                            <span class="n">flobj_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;type&#39;</span> <span class="p">:</span> <span class="n">ftype</span><span class="p">})</span>
                            <span class="n">flobj_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">sid</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiobj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">otype</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">OBJFUNCout</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obj_</span> <span class="ow">in</span> <span class="n">multiobj</span><span class="p">:</span>
                <span class="n">flobjs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fobj_</span> <span class="ow">in</span> <span class="n">obj_</span><span class="p">:</span>
                    <span class="n">otype</span> <span class="o">=</span> <span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>
                    <span class="n">oid</span> <span class="o">=</span> <span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">flobjs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxObjective</span><span class="p">(</span><span class="s">&#39;{}_{}_flobj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">]),</span> <span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span>
                                                        <span class="nb">float</span><span class="p">(</span><span class="n">fobj_</span><span class="p">[</span><span class="s">&#39;coefficient&#39;</span><span class="p">])))</span>
                <span class="n">OBJFUNCout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">otype</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">flobjs</span><span class="p">:</span>
                    <span class="n">OBJFUNCout</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">addFluxObjective</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OBJFUNCout</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">boundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">LboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">UboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">AboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DefinedReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">DefinedReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;C_</span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cntr</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;greater&#39;</span><span class="p">,</span><span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;lower&#39;</span>
                    <span class="n">LboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;less&#39;</span><span class="p">,</span><span class="s">&#39;lessEqual&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;upper&#39;</span>
                    <span class="n">UboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;equal&#39;</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;equal&#39;</span>
                    <span class="n">AboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">O</span><span class="p">)</span>
            <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span>\
                                            <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])))</span>
            <span class="n">cntr</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boundReactionIDs</span><span class="p">:</span>
                <span class="n">boundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>

        <span class="c"># undefined flux bounds are given infinite value</span>
        <span class="n">ubcntr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">##  print boundReactionIDs</span>
        <span class="c">##  print reactionIDs</span>

        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactionIDs</span><span class="p">)):</span>
            <span class="c">##  print reactionIDs[J], reactionsReversability[J]</span>
            <span class="n">LBt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">UBt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ABt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">DefinedReactionIDs</span><span class="p">:</span>
                <span class="n">LBt</span> <span class="o">=</span> <span class="n">UBt</span> <span class="o">=</span> <span class="n">ABt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LboundReactionIDs</span><span class="p">:</span>
                <span class="n">LBt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">UboundReactionIDs</span><span class="p">:</span>
                <span class="n">UBt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">AboundReactionIDs</span><span class="p">:</span>
                <span class="n">ABt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">LBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">UBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not LBt and not UBt and not ABt&#39;</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reactionsReversability</span><span class="p">[</span><span class="n">J</span><span class="p">]:</span>
                    <span class="c">##  print &#39;Adding reversible&#39;</span>
                    <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">##  print &#39;Adding irreversible&#39;</span>
                    <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">LBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not LBt and not ABt&#39;</span>
                <span class="c">#print reactionIDs[J]</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c">#print &#39;Added new lower bound&#39;, newId</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">UBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not UBt and not ABt&#39;</span>
                <span class="c"># print reactionIDs[J]</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c"># print &#39;Added new upper bound&#39;, newId</span>

    <span class="c">#printl(CONSTR)</span>
    <span class="c">#printl(__HAVE_FBA_ANOT_BNDS__)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">CONSTR</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">REAC</span><span class="p">:</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="n">r_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r_</span><span class="o">.</span><span class="n">reversible</span><span class="p">:</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;{}_{}_bnd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;{}_{}_bnd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;{}_{}_bnd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;{}_{}_bnd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>

    <span class="c"># build model</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="p">)</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">sourcefile</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
    <span class="k">del</span> <span class="n">manot</span>
    <span class="n">sbmh</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getModelHistory</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sbmh</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cdate</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getCreatedDate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cdate</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">cdate</span><span class="o">.</span><span class="n">getYear</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getMonth</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getDay</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getHour</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getMinute</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getSecond</span><span class="p">())</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">setCreatedDate</span><span class="p">(</span><span class="n">cdate</span><span class="p">)</span>
        <span class="n">mdate</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getModifiedDate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mdate</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">mdate</span><span class="o">.</span><span class="n">getYear</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getMonth</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getDay</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getHour</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getMinute</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getSecond</span><span class="p">())</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">setModifiedDate</span><span class="p">(</span><span class="n">mdate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sbmh</span><span class="o">.</span><span class="n">getNumCreators</span><span class="p">()):</span>
            <span class="n">sbc</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getCreator</span><span class="p">(</span><span class="n">m_</span><span class="p">)</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addModelCreator</span><span class="p">(</span><span class="n">sbc</span><span class="o">.</span><span class="n">getGivenName</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getFamilyName</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getOrganisation</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getEmail</span><span class="p">())</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">model_description</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addSpecies</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">REAC</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">CONSTR</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">OBJFUNCout</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="n">activeId</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">OBJFUNCout</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">o</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="n">activeId</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">F</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: File deletion failure&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT__</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">WARNING: Missing FBA annotations found&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT_BNDS__</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: No FluxBounds defined (generic bounds created)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">__HAVE_FBA_ANOT_OBJ__</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: No Objective function defined please create one&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">_SBML_LEVEL_</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">buildStoichMatrix</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: unable to construct stoichiometric matrix&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">M</span><span class="p">,</span> <span class="n">D</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_sbml_model</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fm</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="xml_createSBML2FBADoc"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_createSBML2FBADoc">[docs]</a><span class="k">def</span> <span class="nf">xml_createSBML2FBADoc</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a &#39;document&#39; to store the SBML2FBA annotation, returns:</span>

<span class="sd">     - *DOC* a minidom document</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DOM</span> <span class="o">=</span> <span class="n">getDOMImplementation</span><span class="p">()</span>
    <span class="n">DOC</span> <span class="o">=</span> <span class="n">DOM</span><span class="o">.</span><span class="n">createDocument</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:fluxBalance&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">DOC</span><span class="o">.</span><span class="n">documentElement</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&#39;xmlns:fba&#39;</span><span class="p">,</span> <span class="n">FBA_NS</span><span class="p">)</span>
    <span class="n">TOP</span> <span class="o">=</span> <span class="n">DOC</span><span class="o">.</span><span class="n">documentElement</span>
    <span class="n">LoC</span> <span class="o">=</span> <span class="n">DOC</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:listOfConstraints&#39;</span><span class="p">)</span>
    <span class="n">TOP</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">LoC</span><span class="p">)</span>
    <span class="n">LoO</span> <span class="o">=</span> <span class="n">DOC</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:listOfObjectives&#39;</span><span class="p">)</span>
    <span class="n">TOP</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">LoO</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DOC</span>
</div>
<div class="viewcode-block" id="xml_viewSBML2FBAXML"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_viewSBML2FBAXML">[docs]</a><span class="k">def</span> <span class="nf">xml_viewSBML2FBAXML</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a minidom XML document to screen or file, arguments:</span>

<span class="sd">     - *document* a minidom XML document</span>
<span class="sd">     - *fname* [default=None] by default print to screen or write to file fname</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">##  print DOC.toxml(&#39;UTF-8&#39;)</span>
    <span class="c">##  print document.toprettyxml(indent=&#39; &#39;,newl=&#39;\n&#39;,encoding=&#39;UTF-8&#39;)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">FO</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">document</span><span class="o">.</span><span class="n">writexml</span><span class="p">(</span><span class="n">FO</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">addindent</span><span class="o">=</span><span class="s">&#39;    &#39;</span><span class="p">,</span> <span class="n">newl</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="xml_addSBML2FBAFluxBound"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_addSBML2FBAFluxBound">[docs]</a><span class="k">def</span> <span class="nf">xml_addSBML2FBAFluxBound</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fbid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an SBML3FBA flux bound to the document:</span>

<span class="sd">     - *document* a minidom XML document created by xml_createSBML2FBADoc</span>
<span class="sd">     - *rid* the reaction id</span>
<span class="sd">     - *operator* one of [&#39;greater&#39;,&#39;greaterEqual&#39;,&#39;less&#39;,&#39;lessEqual&#39;,&#39;equal&#39;,&#39;&gt;&#39;,&#39;&gt;=&#39;,&#39;&lt;&#39;,&#39;&lt;=&#39;,&#39;=&#39;]</span>
<span class="sd">     - *value* a float which will be cast to a string using str(value)</span>
<span class="sd">     - *fbid* the flux bound id, autogenerated by default</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">OPER</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;greater&#39;</span><span class="p">,</span><span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span><span class="s">&#39;less&#39;</span><span class="p">,</span><span class="s">&#39;lessEqual&#39;</span><span class="p">,</span><span class="s">&#39;equal&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;=&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;=&#39;</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">operator</span> <span class="ow">in</span> <span class="n">OPER</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Bad operator </span><span class="si">%s</span><span class="s"> should be one of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">OPER</span><span class="p">))</span>
    <span class="n">LoC</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;fba:listOfConstraints&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:constraint&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:reaction&#39;</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:operation&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;inf&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;-inf&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fbid</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;type&#39;</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;greater&#39;</span><span class="p">,</span><span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;=&#39;</span><span class="p">]:</span>
            <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;lower&#39;</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;less&#39;</span><span class="p">,</span><span class="s">&#39;lessEqual&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;=&#39;</span><span class="p">]:</span>
            <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;upper&#39;</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;equal&#39;</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">]:</span>
            <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;equal&#39;</span>
        <span class="n">fbid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span>

    <span class="c">#METAID</span>
    <span class="c">#F.setAttributeNS(FBA_NS,&#39;metaid&#39;, fbid)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">fbid</span><span class="p">)</span>
    <span class="n">LoC</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="xml_createListOfFluxObjectives"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_createListOfFluxObjectives">[docs]</a><span class="k">def</span> <span class="nf">xml_createListOfFluxObjectives</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">fluxObjectives</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a list of fluxObjectives to add to an Objective:</span>

<span class="sd">     - *document* a minidom XML document created by xml_createSBML2FBADoc</span>
<span class="sd">     - *fluxobjs* a list of (rid, coefficient) tuples</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LoF</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:listOfFluxes&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="n">fluxObjectives</span><span class="p">:</span>
        <span class="n">FO</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:fluxObjective&#39;</span><span class="p">)</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:reaction&#39;</span><span class="p">,</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:coefficient&#39;</span><span class="p">,</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">LoF</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">FO</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">LoF</span>
</div>
<div class="viewcode-block" id="xml_createSBML2FBAObjective"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_createSBML2FBAObjective">[docs]</a><span class="k">def</span> <span class="nf">xml_createSBML2FBAObjective</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">sense</span><span class="p">,</span> <span class="n">fluxObjectives</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a list of fluxObjectives to add to an Objective:</span>

<span class="sd">     - *document* a minidom XML document created by xml_createSBML2FBADoc</span>
<span class="sd">     - *oid* the objective id</span>
<span class="sd">     - *sense* a string containing the objective sense either: **maximize** or **minimize**</span>
<span class="sd">     - *fluxObjectives* a list of (rid, coefficient) tuples</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sense</span> <span class="o">=</span> <span class="n">sense</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="n">sense</span> <span class="o">=</span> <span class="s">&#39;maximize&#39;</span>
    <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="n">sense</span> <span class="o">=</span> <span class="s">&#39;minimize&#39;</span>
    <span class="k">if</span> <span class="n">sense</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;maximise&#39;</span><span class="p">,</span> <span class="s">&#39;minimise&#39;</span><span class="p">]:</span>
        <span class="n">sense</span> <span class="o">=</span> <span class="n">sense</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;se&#39;</span><span class="p">,</span><span class="s">&#39;ze&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">sense</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;maximize&#39;</span><span class="p">,</span> <span class="s">&#39;minimize&#39;</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Type must be [&#39;maximize&#39;, &#39;minimize&#39;] not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sense</span>
    <span class="n">OBJ</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:objective&#39;</span><span class="p">)</span>
    <span class="n">OBJ</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">oid</span><span class="p">)</span>
    <span class="c">#METAID</span>
    <span class="c">#OBJ.setAttributeNS(FBA_NS,&#39;metaid&#39;, oid)</span>
    <span class="n">OBJ</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:type&#39;</span><span class="p">,</span> <span class="n">sense</span><span class="p">)</span>
    <span class="n">LoF</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:listOfFluxes&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="n">fluxObjectives</span><span class="p">:</span>
        <span class="n">FO</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span> <span class="s">&#39;fba:fluxObjective&#39;</span><span class="p">)</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:reaction&#39;</span><span class="p">,</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">FO</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:coefficient&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">LoF</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">FO</span><span class="p">)</span>
    <span class="n">OBJ</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">LoF</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">OBJ</span>
</div>
<div class="viewcode-block" id="xml_addSBML2FBAObjective"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_addSBML2FBAObjective">[docs]</a><span class="k">def</span> <span class="nf">xml_addSBML2FBAObjective</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an objective element to the documents listOfObjectives and sets the active attribute:</span>

<span class="sd">     - *document* a minidom XML document created by `xml_createSBML2FBADoc`</span>
<span class="sd">     - *objective* a minidom XML objective element created with `xml_createSBML2FBAObjective`</span>
<span class="sd">     - *active* [default=True] a boolean flag specifiying whether this objective is active</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LoO</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;fba:listOfObjectives&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
        <span class="n">xid</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">getAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">LoO</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="n">FBA_NS</span><span class="p">,</span><span class="s">&#39;fba:activeObjective&#39;</span><span class="p">,</span> <span class="n">xid</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Setting active objective: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xid</span><span class="p">))</span>
    <span class="n">LoO</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="xml_getSBML2FBAannotation"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.xml_getSBML2FBAannotation">[docs]</a><span class="k">def</span> <span class="nf">xml_getSBML2FBAannotation</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and returns the SBML3FBA annotation as an XML string:</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* [default=None] if supplied the XML will be written to file *fname*</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DOC</span> <span class="o">=</span> <span class="n">xml_createSBML2FBADoc</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="c">##  print f.value</span>
        <span class="n">xml_addSBML2FBAFluxBound</span><span class="p">(</span><span class="n">DOC</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
        <span class="n">fluxobjs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">fo</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span> <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span>  <span class="n">o</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">]</span>
        <span class="n">OBJ</span> <span class="o">=</span> <span class="n">xml_createSBML2FBAObjective</span><span class="p">(</span><span class="n">DOC</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">fluxobjs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">xml_addSBML2FBAObjective</span><span class="p">(</span><span class="n">DOC</span><span class="p">,</span> <span class="n">OBJ</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xml_addSBML2FBAObjective</span><span class="p">(</span><span class="n">DOC</span><span class="p">,</span> <span class="n">OBJ</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xml_viewSBML2FBAXML</span><span class="p">(</span><span class="n">DOC</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DOC</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">newl</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;UTF-8&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sbml_createModelL2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_createModelL2">[docs]</a><span class="k">def</span> <span class="nf">sbml_createModelL2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an SBML model and document:</span>

<span class="sd">     - *fba* a PySCeSCBM model instance</span>
<span class="sd">     - *level* always 2</span>
<span class="sd">     - *version* always 1</span>

<span class="sd">    and returns:</span>

<span class="sd">     - *model* an SBML model</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SBML_LEVEL</span> <span class="o">=</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SBML_VERSION</span> <span class="o">=</span> <span class="n">version</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mid0</span> <span class="o">=</span> <span class="s">&#39;FBAModel&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mid0</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span>

    <span class="n">mid</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">mid0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
            <span class="n">mid</span> <span class="o">+=</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mid</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="s">&#39;id_&#39;</span> <span class="o">+</span> <span class="n">mid</span>

    <span class="n">mname</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
    <span class="k">if</span>  <span class="n">mname</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">]:</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="s">&#39;SBML_CB_MODEL&#39;</span>


    <span class="k">if</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">getLibSBMLVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">40000</span><span class="p">:</span>
        <span class="n">document</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SBMLDocument</span><span class="p">()</span>
        <span class="n">document</span><span class="o">.</span><span class="n">setLevelAndVersion</span><span class="p">(</span><span class="n">SBML_LEVEL</span><span class="p">,</span> <span class="n">SBML_VERSION</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#document = libsbml.SBMLDocument(SBML_LEVEL, SBML_VERSION)</span>
        <span class="n">document</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SBMLDocument</span><span class="p">(</span><span class="n">SBML_LEVEL</span><span class="p">,</span> <span class="n">SBML_VERSION</span><span class="p">)</span>
    <span class="n">document</span><span class="o">.</span><span class="n">getNamespaces</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="p">,</span> <span class="s">&quot;html&quot;</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createModel</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
    <span class="c">## can&#39;t do this right now with the custom annotations</span>
    <span class="c">#miriam = fba.miriam.getAllMIRIAMUris()</span>
    <span class="c">#print &#39;miriam&#39;, miriam</span>
    <span class="c">#if len(miriam) &gt; 0:</span>
        <span class="c">#sbml_setCVterms(model, miriam, model=True)</span>
    <span class="c">## while this may look right it totally screws up things later, notably reaction reagents don&#39;t get set</span>
    <span class="c">#ns = model.getNamespaces()</span>
    <span class="c">#ns.add(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;html&quot;)</span>
    <span class="c">#model.setNamespaces(ns)</span>
    <span class="c">#print model.getNamespaces()</span>



        <span class="c">##  document = libsbml.SBMLDocument(SBML_LEVEL, SBML_VERSION)</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">document</span>
</div>
<span class="k">def</span> <span class="nf">sbml_setCompartmentsL2</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">compartments</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compartments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Warning: no compartments defined adding one called </span><span class="se">\&quot;</span><span class="s">cell</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">compartments</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;cell&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="s">&#39;cell&#39;</span><span class="p">,</span> <span class="s">&#39;dimensions&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;size&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">}})</span>
    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
        <span class="n">comp_def</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createCompartment</span><span class="p">()</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">compartments</span><span class="p">[</span><span class="n">cs</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">compartments</span><span class="p">[</span><span class="n">cs</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">compartments</span><span class="p">[</span><span class="n">cs</span><span class="p">][</span><span class="s">&#39;size&#39;</span><span class="p">]))</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>


<div class="viewcode-block" id="sbml_setCompartmentsL3"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setCompartmentsL3">[docs]</a><span class="k">def</span> <span class="nf">sbml_setCompartmentsL3</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the model compartments.</span>

<span class="sd">     - *model* a libSBML model instance</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">comp_def</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createCompartment</span><span class="p">()</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="c"># TODO: look into this for user selectable units</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="s">&#39;dimensionless&#39;</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="c"># TODO: need to decide what to do here</span>
            <span class="n">comp_def</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comp_def</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>

        <span class="n">comp_def</span><span class="o">.</span><span class="n">setSpatialDimensions</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">())</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">comp_def</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">cs</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">())</span>
            <span class="n">annores</span> <span class="o">=</span> <span class="n">comp_def</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in reaction:&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miriam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">comp_def</span><span class="p">,</span> <span class="n">miriam</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">sboterm</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">getSBOterm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sboterm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">sboterm</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">comp_def</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sboterm</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="sbml_setDescription"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setDescription">[docs]</a><span class="k">def</span> <span class="nf">sbml_setDescription</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the model description as a &lt;note&gt; containing `txt` in an HTML paragraph on the model object.</span>

<span class="sd">     - *model* a libSBML model instance</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">##  try: UseR = getuser()</span>
    <span class="c">##  except: UseR = &#39;&#39;</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">]:</span>
        <span class="n">notes</span> <span class="o">+=</span> <span class="s">&#39;&lt;html:p&gt;&lt;html:br/&gt;&lt;html:span size=&quot;small&quot;&gt;Model </span><span class="se">\&quot;</span><span class="s">&lt;html:strong&gt;</span><span class="si">%s</span><span class="s">&lt;/html:strong&gt;</span><span class="se">\&quot;</span><span class="s"> (</span><span class="si">%s</span><span class="s">) generated with &lt;html:a href=&quot;http://cbmpy.sourceforge.net&quot;&gt;CBMPy&lt;/html:a&gt; (</span><span class="si">%s</span><span class="s">) on </span><span class="si">%s</span><span class="s">.&lt;/html:span&gt;&lt;/html:p&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="n">fba</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">__version__</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">notes</span> <span class="o">+=</span> <span class="s">&#39;&lt;html:p&gt;&lt;html:span style=&quot;font-family: Courier New,Courier,monospace;&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/html:span&gt;&lt;/html:p&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">description</span>
    <span class="c">#if fba._SBML_LEVEL_ == 2:</span>
        <span class="c">#notes = &#39;&lt;body xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&gt;\n%s&lt;/body&gt;&#39; % notes</span>
    <span class="c">#else:</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">notes</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">())</span>
        <span class="n">annores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in model:&#39;</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
            <span class="k">print</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">(),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sbml_setNotes3"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setNotes3">[docs]</a><span class="k">def</span> <span class="nf">sbml_setNotes3</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats the CBMPy notes as an SBML note and adds it to the SBMl object</span>

<span class="sd">     - *obj* an SBML object</span>
<span class="sd">     - *s* a string that should be added as a note</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&lt;html:body&gt;{}&lt;/html:body&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="sbml_setUnits"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setUnits">[docs]</a><span class="k">def</span> <span class="nf">sbml_setUnits</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">give_default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">L3</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds units to the model:</span>

<span class="sd">    - *model* a libSBML model instance</span>
<span class="sd">    - *units* [default=None] a dictionary of units, if None default units are used</span>
<span class="sd">    - *give_default* [default=False] if true method returns the default unit dictionary</span>
<span class="sd">    - *L3* [default=True] use the L3 defaults</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">L3</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">UNIT_DICTIONARY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">UNIT_DICTIONARY_L2</span>

    <span class="k">if</span> <span class="n">give_default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">units</span>

    <span class="k">for</span> <span class="n">un</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
        <span class="n">vdef</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createUnitDefinition</span><span class="p">()</span>
        <span class="n">vdef</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
        <span class="n">vdef</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L3</span> <span class="ow">and</span> <span class="n">un</span> <span class="ow">in</span> <span class="n">MODEL_UNITS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">MODEL_UNITS</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">un</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setTimeUnits</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MODEL_UNITS</span><span class="p">[</span><span class="s">&#39;extent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">un</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setExtentUnits</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MODEL_UNITS</span><span class="p">[</span><span class="s">&#39;substance&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">un</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setSubstanceUnits</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">un</span><span class="p">])):</span>
            <span class="n">vu</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createUnit</span><span class="p">()</span>
            <span class="n">vu</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">UnitKind_forName</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">un</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s">&#39;kind&#39;</span><span class="p">]))</span>
            <span class="n">vu</span><span class="o">.</span><span class="n">setMultiplier</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">un</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s">&#39;multiplier&#39;</span><span class="p">])</span>
            <span class="n">vu</span><span class="o">.</span><span class="n">setScale</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">un</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s">&#39;scale&#39;</span><span class="p">]))</span>
            <span class="n">vu</span><span class="o">.</span><span class="n">setExponent</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">un</span><span class="p">][</span><span class="n">u</span><span class="p">][</span><span class="s">&#39;exponent&#39;</span><span class="p">]))</span>
            <span class="n">vu</span><span class="o">.</span><span class="n">setOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sbml_writeAnnotationsAsCOBRANote"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_writeAnnotationsAsCOBRANote">[docs]</a><span class="k">def</span> <span class="nf">sbml_writeAnnotationsAsCOBRANote</span><span class="p">(</span><span class="n">annotations</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the annotations dictionary as a COBRA compatible SBML &lt;note&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">annoSTR</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="c"># this is to keep COBRA happy</span>
        <span class="k">if</span> <span class="n">K</span> <span class="o">==</span> <span class="s">&#39;subsystem&#39;</span><span class="p">:</span>
            <span class="n">Kcob</span> <span class="o">=</span> <span class="s">&#39;SUBSYSTEM&#39;</span>
        <span class="k">elif</span> <span class="n">K</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;gene_association&#39;</span><span class="p">,</span> <span class="s">&#39;GENE_ASSOCIATION&#39;</span><span class="p">]:</span>
            <span class="n">Kcob</span> <span class="o">=</span> <span class="s">&#39;GENE ASSOCIATION&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Kcob</span> <span class="o">=</span> <span class="n">K</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">annotations</span><span class="p">[</span><span class="n">K</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
        <span class="n">annoSTR</span> <span class="o">+=</span> <span class="s">&quot;&lt;html:p&gt;{}: {}&lt;/html:p&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Kcob</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">annoSTR</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">annoSTR</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">annoSTR</span>
</div>
<div class="viewcode-block" id="sbml_setSpeciesL2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setSpeciesL2">[docs]</a><span class="k">def</span> <span class="nf">sbml_setSpeciesL2</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dicts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the species definitions to the SBML object:</span>

<span class="sd">     - *model* [default=&#39;&#39;] a libSBML model instance or can be None if *return_dicts* == True</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>
<span class="sd">     - *return_dicts* [default=False] only returns the compartment and species dictionaries without updated the SBML</span>

<span class="sd">    returns:</span>

<span class="sd">     - *compartments* a dictionary of compartments (except when give *return_dicts* argument)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">compartments</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">species</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compartments</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span> <span class="s">&#39;size&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;dimensions&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">}})</span>
        <span class="c">#print &#39;++&#39;, s.charge</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">miriam</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
        <span class="n">species</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span>
                                      <span class="s">&#39;compartment&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span>
                                      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                      <span class="s">&#39;charge&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                                      <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                      <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                      <span class="s">&#39;boundary&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">,</span>
                                      <span class="s">&#39;chemFormula&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span><span class="p">,</span>
                                      <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">miriam</span>
                                      <span class="p">}</span>
                        <span class="p">})</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compartments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Warning: no compartments defined adding one called </span><span class="se">\&quot;</span><span class="s">cell</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">compartments</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;cell&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="s">&#39;cell&#39;</span><span class="p">,</span> <span class="s">&#39;dimensions&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;size&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">}})</span>

    <span class="k">if</span> <span class="n">return_dicts</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">compartments</span><span class="p">,</span> <span class="n">species</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
    <span class="c">#keys.sort()</span>
    <span class="k">for</span> <span class="n">spe</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createSpecies</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="c">#METAID</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="c">#if not (species[spe][&#39;charge&#39;] != None or species[spe][&#39;charge&#39;] != &#39;&#39;):</span>
            <span class="c">#s.setCharge(int(species[spe][&#39;charge&#39;]))</span>
        <span class="n">Ranno</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="c">#print species[spe][&#39;charge&#39;], int(species[spe][&#39;charge&#39;])</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">setCharge</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]))</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unable to set charge, L{}V{} &gt; L2V1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getLevel</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">getVersion</span><span class="p">()))</span>
                <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                    <span class="n">Ranno</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;CHARGE&#39;</span> <span class="p">:</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]})</span>

        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;compartment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;compartment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="s">&#39;cell&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;compartment&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;boundary&#39;</span><span class="p">]:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setBoundaryCondition</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="c">#s.setConstant(True)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setBoundaryCondition</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span>  <span class="bp">None</span><span class="p">]:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setInitialConcentration</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]))</span>
            <span class="c">##  s.setInitialAmount(float(species[spe][&#39;value&#39;]))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setHasOnlySubstanceUnits</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">annoSTR</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#if species[spe][&#39;chemFormula&#39;] != None and species[spe][&#39;chemFormula&#39;] != &#39;&#39;:</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;chemFormula&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="n">Ranno</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;FORMULA&#39;</span> <span class="p">:</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;chemFormula&#39;</span><span class="p">]})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ranno</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTR</span> <span class="o">=</span> <span class="n">sbml_writeAnnotationsAsCOBRANote</span><span class="p">(</span><span class="n">Ranno</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annoSTR</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nres</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">annoSTR</span><span class="p">)</span>
        <span class="c"># this should go last</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">compartments</span>

</div>
<div class="viewcode-block" id="sbml_setReactionsL2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setReactionsL2">[docs]</a><span class="k">def</span> <span class="nf">sbml_setReactionsL2</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the FBA instance reactions to the SBML model</span>

<span class="sd">     - *model* an SBML model instance</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>
<span class="sd">     - *return_dict* [default=False] if True do not add reactions to SBML document instead return a dictionary description of the reactions</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SBML_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SBML_VERSION</span> <span class="o">=</span><span class="mi">1</span>
    <span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rg</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reactants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">miriam</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span>
                                        <span class="s">&#39;reactants&#39;</span> <span class="p">:</span> <span class="n">reactants</span><span class="p">,</span>
                                        <span class="s">&#39;products&#39;</span> <span class="p">:</span> <span class="n">products</span><span class="p">,</span>
                                        <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                        <span class="s">&#39;reversible&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">reversible</span><span class="p">,</span>
                                        <span class="s">&#39;exchange&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">,</span>
                                        <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                        <span class="s">&#39;compartment&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span>
                                        <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">miriam</span>
                                        <span class="p">}</span>
                          <span class="p">})</span>
    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">reactions</span>

    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
        <span class="c"># print &#39;Adding reaction:&#39;, reactions[rxn][&#39;id&#39;]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createReaction</span><span class="p">()</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="c">#METAID</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">])):</span>
            <span class="c">#print &#39;\t&#39; + reactions[rxn][&#39;id&#39;] +&#39; has substrate: &#39; + s.name + &#39; (%s)&#39; % abs(rxn.stoichiometry[s.name])</span>
            <span class="k">if</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">getLibSBMLVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">40000</span><span class="p">:</span>
                <span class="n">sref</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SpeciesReference</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sref</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SpeciesReference</span><span class="p">(</span><span class="n">SBML_LEVEL</span><span class="p">,</span> <span class="n">SBML_VERSION</span><span class="p">)</span>
                <span class="n">sref</span><span class="o">.</span><span class="n">setStoichiometry</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">sref</span><span class="o">.</span><span class="n">setSpecies</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="c">#METAID</span>
            <span class="c">#sref.setMetaId(&#39;%s_%s&#39; % (reactions[rxn][&#39;id&#39;], reactions[rxn][&#39;reactants&#39;][s][1]))</span>
            <span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">addReactant</span><span class="p">(</span><span class="n">sref</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Error setting reagent&#39;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">])):</span>
            <span class="c">#print &#39;\t&#39; + reactions[rxn][&#39;id&#39;] +&#39; has product: &#39; + p.name + &#39; (%s)&#39; % abs(rxn.stoichiometry[p.name])</span>
            <span class="k">if</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">getLibSBMLVersion</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">40000</span><span class="p">:</span>
                <span class="n">pref</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SpeciesReference</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pref</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">SpeciesReference</span><span class="p">(</span><span class="n">SBML_LEVEL</span><span class="p">,</span> <span class="n">SBML_VERSION</span><span class="p">)</span>
                <span class="n">pref</span><span class="o">.</span><span class="n">setStoichiometry</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">pref</span><span class="o">.</span><span class="n">setSpecies</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="c">#METAID</span>
            <span class="c">#pref.setMetaId(&#39;%s_%s&#39; % (reactions[rxn][&#39;id&#39;], reactions[rxn][&#39;products&#39;][p][1]))</span>
            <span class="k">assert</span> <span class="n">r</span><span class="o">.</span><span class="n">addProduct</span><span class="p">(</span><span class="n">pref</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Error setting product&#39;</span>
        <span class="n">Ranno</span> <span class="o">=</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
        <span class="c"># TODO: investigate this</span>
        <span class="c">#if &#39;GENE_ASSOCIATION&#39; in Ranno:</span>
            <span class="c">#Ranno.update({&#39;GENE ASSOCIATION&#39; : Ranno.pop(&#39;GENE_ASSOCIATION&#39;)})</span>
        <span class="c">#print &#39;Ranno&#39;, Ranno</span>
        <span class="n">annoSTR</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ranno</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTR</span> <span class="o">=</span> <span class="n">sbml_writeAnnotationsAsCOBRANote</span><span class="p">(</span><span class="n">Ranno</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annoSTR</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nres</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">annoSTR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nres</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">nres</span><span class="p">,</span> <span class="n">annoSTR</span><span class="p">)</span>
            <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">Ranno</span><span class="p">)</span> <span class="c"># future compatability with L3</span>
            <span class="n">annores</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reversible&#39;</span><span class="p">]:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setReversible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setReversible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># this should go last</span>
        <span class="c"># this may be a bug in libSBML in that setCVterm needs to come after appendAnnotation</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sbml_exportSBML2FBAModel"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_exportSBML2FBAModel">[docs]</a><span class="k">def</span> <span class="nf">sbml_exportSBML2FBAModel</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_doc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">remove_note_body</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes an SBML model object to file. Note this is an internal SBML method use `sbml_writeSBML2FBA()` to write an FBA model:</span>

<span class="sd">     - *model* a libSBML model instance</span>
<span class="sd">     - *filename* the output filename</span>
<span class="sd">     - *directory* [default=None] by default use filename otherwise join, &lt;dir&gt;&lt;filename&gt;</span>
<span class="sd">     - *return_doc* [default=False] return the SBML document used to write the XML</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s"> does not exist.&#39;</span> <span class="o">%</span> <span class="n">directory</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Writing file: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span> <span class="n">UseR</span> <span class="o">=</span> <span class="n">getuser</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">UseR</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="n">SBML_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SBML_VERSION</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c">#raw_input(&#39;L%sV%s&#39; % (document.getLevel(),document.getVersion()))</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">h1</span> <span class="o">+=</span> <span class="s">&#39;&lt;!-- Created with CBMPy (&#39;</span><span class="o">+</span> <span class="n">__version__</span> <span class="o">+</span> <span class="s">&#39;) on &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; by &#39;</span><span class="o">+</span><span class="n">UseR</span><span class="o">+</span><span class="s">&#39; --&gt;</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="n">SBMLDoc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">toSBML</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">remove_note_body</span><span class="p">:</span>
        <span class="n">SBMLDoc</span> <span class="o">=</span> <span class="n">SBMLDoc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;body xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">SBMLDoc</span> <span class="o">=</span> <span class="n">SBMLDoc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/body&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">h1</span> <span class="o">+</span> <span class="n">SBMLDoc</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Model exported as: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sbml_writeSBML2FBA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_writeSBML2FBA">[docs]</a><span class="k">def</span> <span class="nf">sbml_writeSBML2FBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as SBML L3 FBA:</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>
<span class="sd">     - *sbml_level_version* [default=None] a tuple containing the SBML level and version e.g. (2,4) (ignored)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">##  __DEBUG__ = True</span>

    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SBML not available ... install libSBML with Python bindings for SBML support&quot;</span>

    <span class="n">SBML_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SBML_VERSION</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c">#  create L3 as annotation</span>
    <span class="n">L3FBA</span> <span class="o">=</span> <span class="n">xml_getSBML2FBAannotation</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="s">&#39;test_xml.xml&#39;</span><span class="p">)</span> <span class="c"># should be None</span>

    <span class="c"># create a model</span>
    <span class="n">SMOD</span><span class="p">,</span> <span class="n">document</span> <span class="o">=</span> <span class="n">sbml_createModelL2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">SBML_LEVEL</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">SBML_VERSION</span><span class="p">)</span>
    <span class="n">sbml_setDescription</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">fba</span><span class="p">)</span>
    <span class="n">sbml_setUnits</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">L3</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">sbml_setSpeciesL2</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">fba</span><span class="p">)</span>
    <span class="n">sbml_setCompartmentsL2</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">sbml_setReactionsL2</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">SMOD</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="n">L3FBA</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="n">sbml_exportSBML2FBAModel</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">return_doc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Model&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">L3FBA</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">pprint</span>
        <span class="n">PP</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Units&#39;</span><span class="p">)</span>
        <span class="n">PP</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">sbml_setUnits</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">give_default</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Compartments&#39;</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">sbml_setSpeciesL2</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dicts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">PP</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Species&#39;</span><span class="p">)</span>
        <span class="n">PP</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Reactions&#39;</span><span class="p">)</span>
        <span class="n">PP</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">sbml_setReactionsL2</span><span class="p">(</span><span class="n">SMOD</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

</div>
<span class="k">class</span> <span class="nc">FBCconnect</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">metaprefix</span> <span class="o">=</span> <span class="s">&#39;meta_&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sbml</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sbmllevel</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">sbmlversion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">groupsversion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">sbmlns</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">fbc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">fbcversion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fbcstrict</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">maxobjname</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;maximize&#39;</span><span class="p">,</span> <span class="s">&#39;maximise&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">)</span>
    <span class="n">minobjname</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;minimize&#39;</span><span class="p">,</span><span class="s">&#39;minimise&#39;</span><span class="p">,</span><span class="s">&#39;min&#39;</span><span class="p">)</span>
    <span class="n">GROUPS_AVAILABLE</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">groupList</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fbc_version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fbc_strict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">enable_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect SBML Packages</span>

<span class="sd">         - *fbc_version* [default=1] fbc version</span>
<span class="sd">         - *fbc_strict* [default=True] if using FBC V2 set the strict flag</span>
<span class="sd">         - *enable_groups* [default=False] use the Groups package if possible</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">ERROR: libSBML required for SBML support&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span> <span class="o">=</span> <span class="n">libsbml</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbcversion</span> <span class="o">=</span> <span class="n">fbc_version</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkPackageRegistry</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">SBML Level 3 FBC package required!</span><span class="se">\n</span><span class="s">(http://sbml.org/Documents/Specifications/SBML_Level_3/Packages/Flux_Balance_Constraints_</span><span class="si">%28f</span><span class="s">lux%29)&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">SBMLNamespaces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbmllevel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbmlversion</span><span class="p">,</span> <span class="s">&#39;fbc&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbcversion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span><span class="o">.</span><span class="n">addNamespace</span><span class="p">(</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="p">,</span> <span class="s">&quot;html&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">enable_groups</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkPackageRegistry</span><span class="p">(</span><span class="s">&#39;groups&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span><span class="o">.</span><span class="n">addNamespace</span><span class="p">(</span><span class="s">&quot;http://www.sbml.org/sbml/level3/version1/groups/version1&quot;</span><span class="p">,</span> <span class="s">&quot;groups&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">SBMLDocument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">setPackageRequired</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">createModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&quot;fbc&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span><span class="p">:</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">setPackageRequired</span><span class="p">(</span><span class="s">&#39;groups&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&#39;groups&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">WARNING: Groups initialisation error, not enabled.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">fbc_strict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fbcstrict</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">setStrict</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">SBML Level 3 FBC package required!</span><span class="se">\n</span><span class="s">(http://sbml.org/Documents/Specifications/SBML_Level_3/Packages/Flux_Balance_Constraints_</span><span class="si">%28f</span><span class="s">lux%29)&#39;</span>

    <span class="k">def</span> <span class="nf">_checkPackageRegistry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">):</span>
        <span class="n">pkgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">SBMLExtensionRegistry</span><span class="o">.</span><span class="n">getNumRegisteredPackages</span><span class="p">()):</span>
            <span class="n">pkgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">SBMLExtensionRegistry</span><span class="o">.</span><span class="n">getRegisteredPackageName</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgs</span>


    <span class="k">def</span> <span class="nf">createGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a group to the SBML model.</span>

<span class="sd">         - *grp* the cbmpy group object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>






    <span class="k">def</span> <span class="nf">createGroupLegacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to add a group to the model if (assuming the groups package is available).</span>

<span class="sd">         - *gid* the group name</span>
<span class="sd">         - *groups* a list of strings that refer to model SId&#39;s</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">getListOfGroups</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="n">gl</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gl</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Group {} exists appending items&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gid</span><span class="p">))</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Group {} does not exist creating&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gid</span><span class="p">))</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">createGroup</span><span class="p">()</span>
            <span class="n">G</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">createMember</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">setIdRef</span><span class="p">(</span><span class="n">m_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: cannot add {} to group {} as it is not a valid model id&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m_</span><span class="p">,</span> <span class="n">gid</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">createFluxBoundV1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">FB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">createFluxBound</span><span class="p">()</span>
        <span class="n">FB</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
        <span class="n">FB</span><span class="o">.</span><span class="n">setReaction</span><span class="p">(</span><span class="n">reaction</span><span class="p">)</span>
        <span class="n">FB</span><span class="o">.</span><span class="n">setOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;-inf&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Cannot interpret bound </span><span class="si">%s</span><span class="s"> with value </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">createObjective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">osense</span><span class="p">,</span> <span class="n">flux_objs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and add the FBC Objective function</span>

<span class="sd">         - *oid* objective id</span>
<span class="sd">         - *osense* objective sense</span>
<span class="sd">         - *flux_objs* [(reaction, coefficient)]</span>
<span class="sd">         - *name*</span>
<span class="sd">         - *active*</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">createObjective</span><span class="p">()</span>
        <span class="n">O</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">O</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">osense</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxobjname</span><span class="p">:</span>
            <span class="n">osense</span> <span class="o">=</span> <span class="s">&#39;maximize&#39;</span>
        <span class="k">elif</span> <span class="n">osense</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minobjname</span><span class="p">:</span>
            <span class="n">osense</span> <span class="o">=</span> <span class="s">&#39;minimize&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Unknown objective sense: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">osense</span><span class="p">)</span>
        <span class="n">O</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">osense</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">setActiveObjectiveId</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fo_</span> <span class="ow">in</span> <span class="n">flux_objs</span><span class="p">:</span>
            <span class="n">FO</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">createFluxObjective</span><span class="p">()</span>
            <span class="n">FO</span><span class="o">.</span><span class="n">setReaction</span><span class="p">(</span><span class="n">fo_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">FO</span><span class="o">.</span><span class="n">setCoefficient</span><span class="p">(</span><span class="n">fo_</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">createGeneAssociationV1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">gprid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a gene association for a specified reaction and an association string</span>

<span class="sd">         - *rid* a reaction id</span>
<span class="sd">         - *assoc* the association string e.g.(b0698 and b0697) or (b0696)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">GPR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">createGeneAssociation</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gprid</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">GPR</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="s">&#39;{}_gpra&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">GPR</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">gprid</span><span class="p">)</span>

        <span class="n">GA</span> <span class="o">=</span> <span class="n">GPR</span><span class="o">.</span><span class="n">createAssociation</span><span class="p">()</span>
        <span class="n">ass</span> <span class="o">=</span> <span class="n">GA</span><span class="o">.</span><span class="n">parseInfixAssociation</span><span class="p">(</span><span class="n">assoc</span><span class="p">)</span>
        <span class="c"># libSBML parsing workaround required</span>
        <span class="k">if</span> <span class="n">ass</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ret0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret1</span> <span class="o">=</span> <span class="n">GPR</span><span class="o">.</span><span class="n">setAssociation</span><span class="p">(</span><span class="n">ass</span><span class="p">)</span>
            <span class="n">ret2</span> <span class="o">=</span> <span class="n">GPR</span><span class="o">.</span><span class="n">setReaction</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ret2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ret0</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">ret1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;ERROR: Could not set association: </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;\n\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;ERROR: Could not set reaction: </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;\n\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Possible invalid gene id: </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s"> - </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s"> is not a valid gene association&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">GPR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GPR</span>


    <span class="k">def</span> <span class="nf">writeToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">writeSBMLToFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cleanUP_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span> <span class="o">=</span> <span class="bp">None</span>



<span class="c">#def sbml_writeAnnotations(annotations):</span>
    <span class="c">#&quot;&quot;&quot;</span>
    <span class="c">#Writes the annotations dictionary as a BiGG compatible SBML &lt;note&gt; and a new style SBML parameter annotation</span>
    <span class="c">#&quot;&quot;&quot;</span>
    <span class="c">#raise NotImplemented</span>
    <span class="c">#annoSTR = &#39;&#39;</span>
    <span class="c">#for K in annotations:</span>
        <span class="c">#val = str(annotations[K]).replace(&#39;&lt;&#39;,&#39;&amp;lt;&#39;).replace(&#39;&gt;&#39;,&#39;&amp;gt;&#39;)</span>
        <span class="c">###  val = str(annotations[K]).replace(&quot;&#39;&quot;,&#39;&#39;).replace(&#39;&lt;&#39;,&#39;&amp;lt;&#39;).replace(&#39;&gt;&#39;,&#39;&amp;gt;&#39;)</span>
        <span class="c">#annoSTR += &quot;&lt;html:p&gt;%s: %s&lt;/html:p&gt;\n&quot; % (K, val)</span>
    <span class="c">###  print annoSTR</span>
    <span class="c">#return annoSTR</span>


<span class="k">class</span> <span class="nc">CBMtoSBML3</span><span class="p">(</span><span class="n">FBCconnect</span><span class="p">):</span>
    <span class="n">fba</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">bound_registry</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">parameter_map</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">parameter_cntr</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">fbc_version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fbc_strict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">enable_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a CBM model to SBML level 3 with FBC</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CBMtoSBML3</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">fbc_version</span><span class="p">,</span> <span class="n">fbc_strict</span><span class="p">,</span> <span class="n">enable_groups</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fba</span> <span class="o">=</span> <span class="n">fba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mid0</span> <span class="o">=</span> <span class="s">&#39;CBMPY_Model&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mid0</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span>

        <span class="n">mid</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">mid0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                <span class="n">mid</span> <span class="o">+=</span> <span class="n">l</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="s">&#39;MODEL_&#39;</span> <span class="o">+</span> <span class="n">mid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span> <span class="o">+</span> <span class="n">mid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addModelAnnotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fba</span><span class="p">):</span>
        <span class="c"># this should go last</span>
        <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
            <span class="c">#print(miriam)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miriam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">miriam</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addModelHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If they exist add CBM model history information to SBML model</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sbmh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">ModelHistory</span><span class="p">()</span>
        <span class="n">GO</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_CREATED</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]:</span>
            <span class="n">sbmh</span><span class="o">.</span><span class="n">setCreatedDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_CREATED</span><span class="p">))</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_MODIFIED</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]:</span>
            <span class="n">sbmh</span><span class="o">.</span><span class="n">setModifiedDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_MODIFIED</span><span class="p">))</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">:</span>
                <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">ModelCreator</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;firstname&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">setGivenName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;firstname&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;lastname&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">setFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;lastname&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;organisation&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">setOrganisation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;organisation&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;email&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">C</span><span class="o">.</span><span class="n">setEmail</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">MODEL_CREATORS</span><span class="p">[</span><span class="n">c_</span><span class="p">][</span><span class="s">&#39;email&#39;</span><span class="p">])</span>
                <span class="n">sbmh</span><span class="o">.</span><span class="n">addCreator</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">C</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">GO</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setModelHistory</span><span class="p">(</span><span class="n">sbmh</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">sbmh</span>

    <span class="k">def</span> <span class="nf">addBoundsV2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compress_bounds</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add FBC V2 style fluxbounds to model</span>

<span class="sd">         - *compress_bounds* [default=False] enable parameter compression</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;INFO: addBoundsV2&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bound_registry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">shared_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">rids</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">ub</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c_</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="n">r_</span> <span class="ow">and</span> <span class="n">c_</span><span class="o">.</span><span class="n">is_bound</span> <span class="o">==</span> <span class="s">&#39;lower&#39;</span><span class="p">:</span>
                    <span class="n">lb</span> <span class="o">=</span> <span class="n">c_</span>
                <span class="k">elif</span> <span class="n">c_</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="n">r_</span> <span class="ow">and</span> <span class="n">c_</span><span class="o">.</span><span class="n">is_bound</span> <span class="o">==</span> <span class="s">&#39;upper&#39;</span><span class="p">:</span>
                    <span class="n">ub</span> <span class="o">=</span> <span class="n">c_</span>
                <span class="k">elif</span> <span class="n">c_</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="n">r_</span> <span class="ow">and</span> <span class="n">c_</span><span class="o">.</span><span class="n">is_bound</span> <span class="o">==</span> <span class="s">&#39;equality&#39;</span><span class="p">:</span>
                    <span class="n">lb</span> <span class="o">=</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">c_</span>
                <span class="k">if</span> <span class="n">lb</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">ub</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shared_values</span><span class="p">:</span>
                <span class="n">shared_values</span><span class="p">[</span><span class="n">ub</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ub</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shared_values</span><span class="p">[</span><span class="n">ub</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shared_values</span><span class="p">:</span>
                <span class="n">shared_values</span><span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shared_values</span><span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ub</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shared_names</span><span class="p">:</span>
                <span class="n">shared_names</span><span class="p">[</span><span class="n">ub</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ub</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shared_names</span><span class="p">[</span><span class="n">ub</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ub</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shared_names</span><span class="p">:</span>
                <span class="n">shared_names</span><span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shared_names</span><span class="p">[</span><span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;upper&#39;</span> <span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
                           <span class="s">&#39;lower&#39;</span> <span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
                           <span class="s">&#39;rid&#39;</span> <span class="p">:</span> <span class="n">r_</span><span class="p">})</span>
        <span class="c">#print(bounds)</span>
        <span class="c">#print(shared_values)</span>
        <span class="c">#print(shared_names)</span>

        <span class="c"># play with bound compression</span>
        <span class="n">shared_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">shared_values</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">POP</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c"># remove unique</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">POP</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># disable compression if there is any annotation</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">POP</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fb_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">][</span><span class="n">fb_</span><span class="p">]</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">][</span><span class="n">fb_</span><span class="p">]</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fb_</span><span class="p">)</span>
                        <span class="n">shared_names</span><span class="p">[</span><span class="n">v_</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fb_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">POP</span><span class="p">:</span>
                <span class="n">shared_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v_</span><span class="p">)</span>
                <span class="n">shared_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shared_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">]])</span>

        <span class="k">for</span> <span class="n">v_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">shared_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">POP</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shared_names</span><span class="p">[</span><span class="n">v_</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c">#print(set(shared_names[v_]))</span>
                <span class="n">POP</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c">#for fb_ in range(len(shared_values[v_])-1, -1, -1):</span>
                <span class="c">#print(v_, fb_)</span>

            <span class="k">if</span> <span class="n">POP</span><span class="p">:</span>
                <span class="n">shared_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v_</span><span class="p">)</span>

        <span class="c">#print(shared_names)</span>

        <span class="n">vp_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">compress_bounds</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v_</span> <span class="ow">in</span> <span class="n">shared_values</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shared_names</span><span class="p">:</span>
                    <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createParameterSharedV2</span><span class="p">(</span><span class="n">v_</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
                    <span class="c">#print(pid)</span>
                    <span class="n">vp_map</span><span class="p">[</span><span class="n">v_</span><span class="p">]</span> <span class="o">=</span> <span class="n">pid</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#print(shared_names[v_])</span>
                    <span class="n">spid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shared_names</span><span class="p">[</span><span class="n">v_</span><span class="p">]))</span>
                    <span class="c">#print(spid)</span>
                    <span class="k">for</span> <span class="n">n_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_names</span><span class="p">[</span><span class="n">v_</span><span class="p">])):</span>
                        <span class="c">#print(shared_names[v_][n_])</span>
                        <span class="n">spidn</span> <span class="o">=</span> <span class="s">&#39;par{}_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_cntr</span><span class="p">,</span> <span class="n">spid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">shared_names</span><span class="p">[</span><span class="n">v_</span><span class="p">][</span><span class="n">n_</span><span class="p">]))</span>
                        <span class="c">#print(spidn)</span>
                        <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createParameterSharedV2</span><span class="p">(</span><span class="n">v_</span><span class="p">,</span> <span class="n">spidn</span><span class="p">,</span> <span class="n">shared_values</span><span class="p">[</span><span class="n">v_</span><span class="p">][</span><span class="n">n_</span><span class="p">]</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
                        <span class="n">vp_map</span><span class="p">[</span><span class="n">v_</span><span class="p">]</span> <span class="o">=</span> <span class="n">pid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_cntr</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spid</span><span class="p">)</span>

        <span class="c">#print(vp_map)</span>

        <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">compress_bounds</span> <span class="ow">and</span> <span class="n">b_</span><span class="p">[</span><span class="s">&#39;lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">in</span> <span class="n">shared_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]][</span><span class="s">&#39;lb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createParameterV2</span><span class="p">(</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;lower&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]][</span><span class="s">&#39;lb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_</span><span class="p">[</span><span class="s">&#39;lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">compress_bounds</span> <span class="ow">and</span> <span class="n">b_</span><span class="p">[</span><span class="s">&#39;upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">in</span> <span class="n">shared_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]][</span><span class="s">&#39;ub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createParameterV2</span><span class="p">(</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;upper&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">b_</span><span class="p">[</span><span class="s">&#39;rid&#39;</span><span class="p">]][</span><span class="s">&#39;ub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_</span><span class="p">[</span><span class="s">&#39;upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">addBoundsV1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autofix</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the CBM fluxbounds to SBML</span>

<span class="sd">         - *autofix* convert &#39;&lt; &gt;&#39; to &#39;&lt;= &gt;=&#39; default = False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bound_registry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fb_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">fb_</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">rid</span> <span class="o">=</span> <span class="n">fb_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fb_</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">fb_</span><span class="o">.</span><span class="n">is_bound</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_registry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bound_registry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
                <span class="n">operation</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">autofix</span> <span class="ow">and</span> <span class="n">fb_</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;less&#39;</span><span class="p">:</span>
                    <span class="n">operation</span> <span class="o">=</span> <span class="s">&#39;lessEqual&#39;</span>
                <span class="k">elif</span> <span class="n">autofix</span> <span class="ow">and</span> <span class="n">fb_</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;greater&#39;</span><span class="p">:</span>
                    <span class="n">operation</span> <span class="o">=</span> <span class="s">&#39;greaterEqual&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">operation</span> <span class="o">=</span> <span class="n">fb_</span><span class="o">.</span><span class="n">operation</span>
                    <span class="c">#print &#39;Illegal operation in bound %s: %s&#39; % (fb_.getPid(), fb_.operation)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createFluxBoundV1</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">fb_</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">fb_</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Bound </span><span class="si">%s</span><span class="s"> already exists, skipping ...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rid</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">addObjectives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the CBM objective function to SBML</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ob_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">ob_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getPid</span><span class="p">():</span>
                <span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">flux_objs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">o2</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">o2</span><span class="o">.</span><span class="n">coefficient</span><span class="p">))</span> <span class="k">for</span> <span class="n">o2</span> <span class="ow">in</span> <span class="n">ob_</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createObjective</span><span class="p">(</span><span class="n">ob_</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="n">ob_</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">flux_objs</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addGenesV2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from_annotation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create genes and add to SBML models (FBC V2)</span>

<span class="sd">         - *parse_from_annotation* [default=False] if the gpr_assoc list is empty e.g. the GPR associations have</span>
<span class="sd">            not been parsed enabling this will do so.</span>
<span class="sd">         - *annotation_key* [default=&#39;GENE ASSOCIATION&#39;] the key to use for the gene association if parse_from_annotation is True</span>
<span class="sd">           by default it will try one of GENE ASSOCIATION, GENE_ASSOCIATION, gene_association, gene association.</span>
<span class="sd">         - *add_cbmpy_anno* [default=True] add PySCeS CBMPy annotation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print(&#39;\n\nINFO: addGenesV2&#39;)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">gpr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">parse_from_annotation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">createGeneAssociationsFromAnnotations</span><span class="p">(</span><span class="n">annotation_key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">genes</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span><span class="o">.</span><span class="n">createGeneProduct</span><span class="p">()</span>
            <span class="n">G</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getMetaId</span><span class="p">())</span>
            <span class="n">G</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>
            <span class="n">sboterm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getSBOterm</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sboterm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">sboterm</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sboterm</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">add_cbmpy_anno</span><span class="p">:</span>
                    <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
                    <span class="n">annores</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in Gene&#39;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># last blah blah</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addGeneProteinAssociationsV1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_from_annotation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the CBM geneProtein associations to SBML from the gpr_assoc list (FBC V1)</span>

<span class="sd">         - *parse_from_annotation* [default=False] if the gpr_assoc list is empty e.g. the GPR associations have</span>
<span class="sd">            not been parsed enabling this will do so.</span>
<span class="sd">         - *annotation_key* [default=&#39;GENE ASSOCIATION&#39;] the key to use for the gene association if parse_from_annotation is True</span>
<span class="sd">           by default it will try one of GENE ASSOCIATION, GENE_ASSOCIATION, gene_association, gene association.</span>
<span class="sd">         - *add_cbmpy_anno* add PySCeS CBMPy annotation (still to be implemented)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">gpr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">parse_from_annotation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">createGeneAssociationsFromAnnotations</span><span class="p">(</span><span class="n">annotation_key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fba</span><span class="o">.</span><span class="n">gpr</span><span class="p">:</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="n">g_</span><span class="o">.</span><span class="n">getProtein</span><span class="p">()</span>
            <span class="n">assoc</span> <span class="o">=</span> <span class="n">g_</span><span class="o">.</span><span class="n">getAssociationStr</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rid</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">rid</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">assoc</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">assoc</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">GPR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createGeneAssociationV1</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">,</span> <span class="n">gprid</span><span class="o">=</span><span class="n">g_</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                    <span class="c">#if g_.annotation != None and len(g_.annotation) &gt; 0:</span>
                        <span class="c">#annoSTRnew = sbml_writeKeyValueDataAnnotation(g_.getAnnotations())</span>
                        <span class="c">#annores = GPR.appendAnnotation(annoSTRnew)</span>
                        <span class="c">#if annores == -3:</span>
                            <span class="c">#printl(&#39;Invalid annotation in GPR:&#39;, g_.getId())</span>
                            <span class="c">#print(g_.annotation)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Skipping GPR association: </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;\n\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">--&gt; </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">g_</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">rid</span><span class="p">,</span> <span class="n">assoc</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">createParameterV2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bnd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create SBML V2 flux bound parameters for reaction</span>

<span class="sd">         - *bnd* object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">createParameter</span><span class="p">()</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="s">&#39;meta_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="c">#print(bnd.getName())</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="s">&#39;SBO:0000625&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
            <span class="n">annores</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in bound:&#39;</span><span class="p">,</span> <span class="n">bnd</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">bnd</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bnd</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">bnd</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miriam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">miriam</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createParameterSharedV2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create SBML V2 flux bound parameters for reaction</span>

<span class="sd">         - *value* parameter value</span>
<span class="sd">         - *pid* optional parameter id</span>
<span class="sd">         - *name* optional name</span>

<span class="sd">         returns parameter id</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="s">&#39;par{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_cntr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_cntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pid</span>
        <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">createParameter</span><span class="p">()</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="s">&#39;meta_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">par</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&#39;shared flux bound parameter&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">par</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">par</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="s">&#39;SBO:0000625&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">par</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_cleanUP_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fba</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_cntr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fbc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbml</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbmlns</span> <span class="o">=</span> <span class="bp">None</span>


<div class="viewcode-block" id="sbml_writeKeyValueDataAnnotation"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_writeKeyValueDataAnnotation">[docs]</a><span class="k">def</span> <span class="nf">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">annotations</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the key:value annotations as a KeyValueData annotation (http://pysces.sourceforge.net/KeyValueData)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">annoSTR</span> <span class="o">=</span> <span class="s">&#39;&lt;listOfKeyValueData xmlns=&quot;http://pysces.sourceforge.net/KeyValueData&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="n">Ktype</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">Kval</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#if type(annotations[K]) == bool:</span>
            <span class="c">#Ktype = &#39;boolean&#39;</span>
        <span class="c">#elif type(annotations[K]) == int or type(annotations[K]) == long:</span>
            <span class="c">#Ktype = &#39;integer&#39;</span>
        <span class="c">#elif type(annotations[K]) == float or type(annotations[K]) == numpy.float or type(annotations[K]) == numpy.double:</span>
            <span class="c">#Ktype = &#39;double&#39;</span>
        <span class="c">#else:</span>
            <span class="c">#Ktype = &#39;string&#39;</span>
        <span class="k">if</span> <span class="n">annotations</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">annotations</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Kval</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="c">##elif isinstance(annotations[K], list):</span>
            <span class="c">###if len(annotations[K]) == 1:</span>
                <span class="c">###Kval = annotations[K][0]</span>
            <span class="c">###else:</span>
                <span class="c">#### this may be a bit dodgy but wtf let&#39;s run with it</span>
                <span class="c">###Kval = [&#39;&amp;apos;{}&amp;apos;&#39;.format(str(v).strip()) for v in annotations[K]]</span>
                <span class="c">###Kval = &#39;[&#39;+&#39;, &#39;.join(map(str, Kval))+&#39;]&#39;</span>
            <span class="c">##Kval = cgi.escape(str(annotations[K]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Kval</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">annotations</span><span class="p">[</span><span class="n">K</span><span class="p">]))</span>

        <span class="c"># fix the key to be sid compatible</span>
        <span class="n">Kfix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">K</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                <span class="n">Kfix</span> <span class="o">+=</span> <span class="n">l</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Kfix</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Kfix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="n">Kfix</span> <span class="o">=</span> <span class="s">&#39;id_&#39;</span> <span class="o">+</span> <span class="n">Kfix</span>
        <span class="c">## taken out for now</span>
        <span class="c">#Kfix = Kfix.lower()</span>

        <span class="c">#annoSTR += &#39; &lt;data id=&quot;%s&quot; type=&quot;%s&quot; value=&quot;%s&quot;/&gt;\n&#39; % (Kfix, Ktype, Kval)</span>
        <span class="n">annoSTR</span> <span class="o">+=</span> <span class="s">&#39; &lt;data id=&quot;{}&quot; value=&quot;{}&quot;/&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Kfix</span><span class="p">,</span> <span class="n">Kval</span><span class="p">)</span>
    <span class="n">annoSTR</span> <span class="o">+=</span> <span class="s">&#39;&lt;/listOfKeyValueData&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="c">#print annoSTR</span>
    <span class="k">return</span> <span class="n">annoSTR</span>
</div>
<span class="n">RE_loKVD1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&lt;data.*?/&gt;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<span class="n">RE_loKVD1_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;id=&quot;.*?&quot;&#39;</span><span class="p">)</span>
<span class="c">#RE_loKVD1_type = re.compile(&#39;type=&quot;.*?&quot;&#39;)</span>
<span class="n">RE_loKVD1_value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;value=&quot;.*?&quot;&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="sbml_readKeyValueDataAnnotation"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_readKeyValueDataAnnotation">[docs]</a><span class="k">def</span> <span class="nf">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">annotations</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads KeyValueData annotation (http://pysces.sourceforge.net/KeyValueData) and returns a dictionary of key:value pairs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">kvout</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s">&#39;&lt;listOfKeyValueData xmlns=&quot;http://pysces.sourceforge.net/KeyValueData&quot;&gt;&#39;</span> <span class="ow">in</span>  <span class="n">annotations</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_loKVD1</span><span class="p">,</span> <span class="n">annotations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">D_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">RE_loKVD1_id</span><span class="p">,</span> <span class="n">D_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pid</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c">#ptype = re.search(RE_loKVD1_type, D_)</span>
            <span class="c">#if ptype != None:</span>
                <span class="c">#ptype = ptype.group(0).split(&#39;=&#39;)[1].strip()[1:-1]</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">RE_loKVD1_value</span><span class="p">,</span> <span class="n">D_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pvalue</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">__tagStripper__</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">pvalue</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pvalue</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">pvalue</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
                        <span class="k">pass</span>
                        <span class="c">#print(&#39;INFO: annotation \&quot;{}\&quot; is not a list.&#39;.format(pvalue))</span>
                <span class="c">#if ptype == &#39;boolean&#39;:</span>
                    <span class="c">#pvalue = bool(pvalue)</span>
                <span class="c">#elif ptype == &#39;integer&#39;:</span>
                    <span class="c">#pvalue = int(pvalue)</span>
                <span class="c">#elif ptype == &#39;double&#39;:</span>
                    <span class="c">#pvalue = float(pvalue)</span>
                <span class="c">#else:</span>
                    <span class="c">#pvalue = str(pvalue)</span>
            <span class="n">kvout</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvalue</span>
    <span class="k">return</span> <span class="n">kvout</span>
</div>
<div class="viewcode-block" id="sbml_setSpeciesL3"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setSpeciesL3">[docs]</a><span class="k">def</span> <span class="nf">sbml_setSpeciesL3</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dicts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cobra_anno</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">substance_units</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the species definitions to the SBML object:</span>

<span class="sd">     - *model* and SBML model instance or can be None if *return_dicts* == True</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>
<span class="sd">     - *return_dicts* [default=False] only returns the compartment and species dictionaries without updating the SBML</span>
<span class="sd">     - *add_cbmpy_anno* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">     - *add_cobra_anno* [default=False] add COBRA &lt;notes&gt; annotation</span>
<span class="sd">     - *substance_units* [default=True] defines the species in amounts rather than concentrations (necessary for default mmol/gdw.h)</span>

<span class="sd">    returns:</span>

<span class="sd">     - *compartments* a dictionary of compartments (except when given *return_dicts* argument)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">compartments</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getCompartmentIds</span><span class="p">()</span>

    <span class="n">species</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">USE_DEFAULT_COMPARTMENT</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">DEFAULT_COMPARTMENT</span> <span class="o">=</span> <span class="s">&#39;Cell&#39;</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">USE_DEFAULT_COMPARTMENT</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">DEFAULT_COMPARTMENT</span>
            <span class="k">if</span> <span class="n">DEFAULT_COMPARTMENT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: Species &quot;{}&quot; has no compartment, creating default &quot;{}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span> <span class="n">DEFAULT_COMPARTMENT</span><span class="p">))</span>
                <span class="n">C</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Compartment</span><span class="p">(</span><span class="n">DEFAULT_COMPARTMENT</span><span class="p">,</span> <span class="n">DEFAULT_COMPARTMENT</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">C</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s">&#39;CBMPy_info&#39;</span><span class="p">,</span> <span class="s">&#39;created by SBML writer&#39;</span><span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s">&#39;CBMPy_info&#39;</span><span class="p">,</span> <span class="s">&#39;compartment added by SBML writer&#39;</span><span class="p">)</span>
                <span class="n">fba</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
                <span class="n">compartments</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getCompartmentIds</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: Compartment &quot;{}&quot; used by species &quot;{}&quot; is not defined, creating.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()))</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Compartment</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">C</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s">&#39;CBMPy_info&#39;</span><span class="p">,</span> <span class="s">&#39;created by SBML writer&#39;</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
            <span class="n">compartments</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getCompartmentIds</span><span class="p">()</span>
        <span class="c">#print &#39;++&#39;, s.charge</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">miriam</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
        <span class="n">species</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span>
                                      <span class="s">&#39;compartment&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span>
                                      <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                      <span class="s">&#39;charge&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                                      <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                      <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                      <span class="s">&#39;boundary&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">,</span>
                                      <span class="s">&#39;chemFormula&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span><span class="p">,</span>
                                      <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">miriam</span><span class="p">,</span>
                                      <span class="s">&#39;sboterm&#39;</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">getSBOterm</span><span class="p">()</span>
                                      <span class="p">}</span>
                        <span class="p">})</span>


    <span class="k">if</span> <span class="n">return_dicts</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">compartments</span><span class="p">,</span> <span class="n">species</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
    <span class="c">#keys.sort()</span>

    <span class="k">for</span> <span class="n">spe</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">createSpecies</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="c">#METAID</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="c"># in theory species are constant at whatever level it is set dX/dT == 0 also there is no way to change them</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> <span class="c">#TODO (201209) think about this</span>
        <span class="c">#if not (species[spe][&#39;charge&#39;] != None or species[spe][&#39;charge&#39;] != &#39;&#39;):</span>
            <span class="c">#s.setCharge(int(species[spe][&#39;charge&#39;]))</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span> <span class="c"># TODO this needs to be considered - bgoli</span>
            <span class="c">#print species[spe][&#39;charge&#39;], int(species[spe][&#39;charge&#39;])</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setCharge</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;charge&#39;</span><span class="p">]))</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unable to set charge for species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;chemFormula&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setChemicalFormula</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;chemFormula&#39;</span><span class="p">]))</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unable to set chemFormula for species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>


        <span class="n">s</span><span class="o">.</span><span class="n">setCompartment</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;compartment&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;boundary&#39;</span><span class="p">]:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setBoundaryCondition</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="c">#s.setConstant(True)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setBoundaryCondition</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#print species[spe][&#39;value&#39;], type(species[spe][&#39;value&#39;])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span>  <span class="bp">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">substance_units</span><span class="p">:</span>
                <span class="c"># set the species to be in amounts or concentrations default is amounts for mmol/gdw.h</span>
                <span class="n">s</span><span class="o">.</span><span class="n">setInitialAmount</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">setHasOnlySubstanceUnits</span><span class="p">(</span><span class="n">substance_units</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">setInitialConcentration</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">add_cbmpy_anno</span><span class="p">:</span>
                <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span>
                <span class="n">annores</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in reaction:&#39;</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_cobra_anno</span><span class="p">:</span>
                <span class="n">annoSTR</span> <span class="o">=</span> <span class="n">sbml_writeAnnotationsAsCOBRANote</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span> <span class="c">#GOOD RIDDANCE</span>
                <span class="k">if</span> <span class="n">annoSTR</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">annoSTR</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sbml_setNotes3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span>  <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">species</span><span class="p">[</span><span class="n">spe</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="sbml_setReactionsL3Fbc"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setReactionsL3Fbc">[docs]</a><span class="k">def</span> <span class="nf">sbml_setReactionsL3Fbc</span><span class="p">(</span><span class="n">fbcmod</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cobra_anno</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fbc_version</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the FBA instance reactions to the SBML model</span>

<span class="sd">     - *fbcmod* a CBM2SBML instance</span>
<span class="sd">     - *fba* a PySCeSCBM model instance</span>
<span class="sd">     - *return_dict* [default=False] if True do not add reactions to SBML document instead return a dictionary description of the reactions</span>
<span class="sd">     - *add_cbmpy_anno* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">     - *add_cobra_anno* [default=False] add COBRA &lt;notes&gt; annotation</span>
<span class="sd">     - *fbc_version* [default=1] writes either FBC v1 (2013) or v2 (2015)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gpr_reaction_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">gpr</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">gpr</span><span class="p">:</span>
        <span class="n">gpr_reaction_map</span><span class="p">[</span><span class="n">gpr</span><span class="o">.</span><span class="n">getProtein</span><span class="p">()]</span> <span class="o">=</span> <span class="n">gpr</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="c">#print(gpr_reaction_map)</span>

    <span class="n">reactions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rg</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reactants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">miriam</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getPid</span><span class="p">(),</span>
                                        <span class="s">&#39;reactants&#39;</span> <span class="p">:</span> <span class="n">reactants</span><span class="p">,</span>
                                        <span class="s">&#39;products&#39;</span> <span class="p">:</span> <span class="n">products</span><span class="p">,</span>
                                        <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                        <span class="s">&#39;reversible&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">reversible</span><span class="p">,</span>
                                        <span class="s">&#39;exchange&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">,</span>
                                        <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                        <span class="s">&#39;compartment&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span>
                                        <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">miriam</span><span class="p">,</span>
                                        <span class="s">&#39;notes&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getNotes</span><span class="p">(),</span>
                                        <span class="s">&#39;sboterm&#39;</span> <span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">getSBOterm</span><span class="p">()</span>
                                        <span class="p">}</span>
                          <span class="p">})</span>
    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">reactions</span>

    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
        <span class="c"># print &#39;Adding reaction:&#39;, reactions[rxn][&#39;id&#39;]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">fbcmod</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">createReaction</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">FB</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="c">#METAID</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="o">+</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">r</span><span class="o">.</span><span class="n">setFast</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">])):</span>
            <span class="n">sref</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">createReactant</span><span class="p">()</span>
            <span class="n">sref</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">sref</span><span class="o">.</span><span class="n">setStoichiometry</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">sref</span><span class="o">.</span><span class="n">setSpecies</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reactants&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">])):</span>
            <span class="n">pref</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">createProduct</span><span class="p">()</span>
            <span class="n">pref</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">pref</span><span class="o">.</span><span class="n">setStoichiometry</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">pref</span><span class="o">.</span><span class="n">setSpecies</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;products&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">add_cbmpy_anno</span><span class="p">:</span>
                <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span>
                <span class="n">annores</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in reaction&#39;</span><span class="p">,</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_cobra_anno</span><span class="p">:</span>
                <span class="n">annoSTR</span> <span class="o">=</span> <span class="n">sbml_writeAnnotationsAsCOBRANote</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">])</span> <span class="c">#GOOD RIDDANCE</span>
                <span class="k">if</span> <span class="n">annoSTR</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">nres</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">annoSTR</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nres</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">nres</span><span class="p">,</span> <span class="n">annoSTR</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;notes&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;notes&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sbml_setNotes3</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;notes&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;reversible&#39;</span><span class="p">]:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setReversible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setReversible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="c">#print(reactions[rxn][&#39;sboterm&#39;])</span>
            <span class="n">r</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;sboterm&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setLowerFluxBound</span><span class="p">(</span><span class="n">fbcmod</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]][</span><span class="s">&#39;lb&#39;</span><span class="p">])</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setUpperFluxBound</span><span class="p">(</span><span class="n">fbcmod</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]][</span><span class="s">&#39;ub&#39;</span><span class="p">])</span>
            <span class="c">#print(gpr_reaction_map)</span>
            <span class="k">if</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gpr_reaction_map</span><span class="p">:</span>
                <span class="n">GPR</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getGPRassociation</span><span class="p">(</span><span class="n">gpr_reaction_map</span><span class="p">[</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]])</span>
                <span class="n">sbgpr</span> <span class="o">=</span> <span class="n">FB</span><span class="o">.</span><span class="n">createGeneProductAssociation</span><span class="p">()</span>
                <span class="n">sbgpr</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">GPR</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">sbgpr</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
                <span class="c">#print(&#39;GPR:&#39;, GPR.getAssociationStr())</span>
                <span class="n">sbml_createAssociationFromAST</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">getAssociationStr</span><span class="p">())</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sbgpr</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">add_cbmpy_anno</span><span class="p">:</span>
                        <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
                        <span class="n">annores</span> <span class="o">=</span> <span class="n">sbgpr</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in reaction GPR association&#39;</span><span class="p">,</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">GPR</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="c"># TODO</span>
                <span class="c">#if GPR.notes != &#39;&#39;:</span>
                    <span class="c">#sbml_setNotes3(sbgpr, GPR.notes)</span>
                <span class="k">if</span> <span class="n">GPR</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># last blah blah</span>
                    <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">sbgpr</span><span class="p">,</span> <span class="n">GPR</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># last blah blah</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<span class="n">G</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="sbml_setGroupsL3"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setGroupsL3">[docs]</a><span class="k">def</span> <span class="nf">sbml_setGroupsL3</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fba</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    add groups to the SBML model</span>

<span class="sd">     - *cs* a CBMLtoSBML instance</span>
<span class="sd">     - *fba* a CBMPy model instance</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cs</span><span class="o">.</span><span class="n">GROUPS_AVAILABLE</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">WARNING: Groups package not available.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">gids</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getGroupIds</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
        <span class="c">#global g</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">createGroup</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">getName</span><span class="p">()))</span>
        <span class="n">metaid</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getMetaId</span><span class="p">()</span>
        <span class="c">#print(grp.getId(), metaid)</span>
        <span class="k">if</span> <span class="n">metaid</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">metaid</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">metaid</span> <span class="o">=</span> <span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="p">,</span> <span class="n">grp</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
        <span class="n">g</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">metaid</span><span class="p">)</span>

        <span class="n">gkind</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getKind</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gkind</span> <span class="ow">in</span> <span class="n">grp</span><span class="o">.</span><span class="n">_kinds_</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gkind</span> <span class="o">==</span> <span class="s">&#39;collection&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">GROUP_KIND_COLLECTION</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">gkind</span> <span class="o">==</span> <span class="s">&#39;partonomy&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">GROUP_KIND_PARTONOMY</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">gkind</span> <span class="o">==</span> <span class="s">&#39;classification&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">GROUP_KIND_CLASSIFICATION</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">sbml</span><span class="o">.</span><span class="n">GROUP_KIND_UNKNOWN</span><span class="p">)</span>

        <span class="n">sbo</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getSBOterm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sbo</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sbo</span><span class="p">))</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getNotes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">notes</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">sbml_setNotes3</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
        <span class="n">lom</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getListOfMembers</span><span class="p">()</span>
        <span class="n">metaid</span> <span class="o">=</span> <span class="s">&#39;{}{}_members&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">METAPREFIX</span><span class="p">,</span> <span class="n">grp</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
        <span class="n">lom</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="n">metaid</span><span class="p">)</span>
        <span class="n">sbo</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getSharedSBOterm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sbo</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lom</span><span class="o">.</span><span class="n">setSBOTerm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sbo</span><span class="p">))</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getSharedNotes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">notes</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">sbml_setNotes3</span><span class="p">(</span><span class="n">lom</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mid</span> <span class="ow">in</span> <span class="n">grp</span><span class="o">.</span><span class="n">getMemberIDs</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">createMember</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">setIdRef</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mid</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
            <span class="n">annores</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in group:&#39;</span><span class="p">,</span> <span class="n">grp</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">sharedAnno</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getSharedAnnotations</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sharedAnno</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">annoSTRnew</span> <span class="o">=</span> <span class="n">sbml_writeKeyValueDataAnnotation</span><span class="p">(</span><span class="n">sharedAnno</span><span class="p">)</span>
            <span class="n">annores</span> <span class="o">=</span> <span class="n">lom</span><span class="o">.</span><span class="n">appendAnnotation</span><span class="p">(</span><span class="n">annoSTRnew</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annores</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Invalid annotation in group:&#39;</span><span class="p">,</span> <span class="n">lom</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">sharedAnno</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">sharedMiriam</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getSharedMIRIAMannotations</span><span class="p">()</span>
        <span class="c">#print(sharedMiriam)</span>
        <span class="k">if</span> <span class="n">sharedMiriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sharedMiriam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">lom</span><span class="p">,</span> <span class="n">sharedMiriam</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grp</span><span class="o">.</span><span class="n">miriam</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">miriam</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">miriam</span><span class="o">.</span><span class="n">getAllMIRIAMUris</span><span class="p">()</span>
            <span class="c">#print(miriam)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">miriam</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sbml_setCVterms</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">miriam</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="sbml_writeCOBRASBML"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_writeCOBRASBML">[docs]</a><span class="k">def</span> <span class="nf">sbml_writeCOBRASBML</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as a COBRA compatible :</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">WARNING: saving in COBRA format may result in a loss of model information!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">sbml_writeSBML3FBC</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">autofix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">return_fbc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">add_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">sbml_convertSBML3FBCToCOBRA</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Model exported as: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="sbml_getGeneRefs"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_getGeneRefs">[docs]</a><span class="k">def</span> <span class="nf">sbml_getGeneRefs</span><span class="p">(</span><span class="n">association</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Walk through a gene association and extract GeneRefs inspired by Frank</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">association</span><span class="p">,</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">GeneProductRef</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">association</span><span class="o">.</span><span class="n">getGeneProduct</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">association</span><span class="o">.</span><span class="n">getNumAssociations</span><span class="p">()):</span>
            <span class="n">sbml_getGeneRefs</span><span class="p">(</span><span class="n">association</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sbml_createAssociationFromAST"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_createAssociationFromAST">[docs]</a><span class="k">def</span> <span class="nf">sbml_createAssociationFromAST</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a GPR string &#39;((g1 and g2) or g3)&#39; to an association via a Python AST.</span>
<span class="sd">    In future I will get rid of all the string elements and work only with associations</span>
<span class="sd">    and AST&#39;s.</span>

<span class="sd">     - *node* a Python AST note (e.g. body)</span>
<span class="sd">     - *out* a new shiny FBC V2 GeneProductAssociation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
        <span class="c">#print(&#39;Name:&#39;, node.id)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">createGeneProductRef</span><span class="p">()</span>
        <span class="n">ref</span><span class="o">.</span><span class="n">setGeneProduct</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c">#ref.setId(node.id)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">):</span>
                <span class="n">newex</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">createAnd</span><span class="p">()</span>
                <span class="c">#print(&#39;And&#39;, v)</span>
                <span class="c">#walk(v, newand)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Or</span><span class="p">):</span>
                <span class="n">newex</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">createOr</span><span class="p">()</span>
                <span class="c">#print(&#39;Or&#39;, v)</span>
                <span class="c">#walk(v, newor)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#print(&#39;--&gt;&#39;, v)</span>
                <span class="n">newex</span> <span class="o">=</span> <span class="n">out</span>
            <span class="n">sbml_createAssociationFromAST</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">newex</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sbml_writeSBML3FBC"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_writeSBML3FBC">[docs]</a><span class="k">def</span> <span class="nf">sbml_writeSBML3FBC</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">autofix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">return_fbc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">gpr_from_annot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>\
                       <span class="n">add_groups</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xoptions</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as SBML L3 FBC:</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>
<span class="sd">     - *sbml_level_version* [default=(3,1)] a tuple containing the SBML level and version e.g. (3,1)</span>
<span class="sd">     - *autofix* convert &lt;&gt; to &lt;=&gt;=</span>
<span class="sd">     - *return_fbc* return the FBC converter instance</span>
<span class="sd">     - *gpr_from_annot* [default=True] if enabled will attempt to add the gene protein associations from the annotations</span>
<span class="sd">       if no gene protein association objects exist</span>
<span class="sd">     - *add_cbmpy_annot* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">     - *add_cobra_annot* [default=True] add COBRA &lt;notes&gt; annotation</span>
<span class="sd">     - *xoptions* extended options</span>

<span class="sd">       - *fbc_version* [default=1] write SBML3FBC using version 1 (2013) or version 2 (2015)</span>
<span class="sd">       - *validate* [default=False] validate the output SBML file</span>
<span class="sd">       - *compress_bounds* [default=False] try compress output flux bound parameters</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SBML not available ... install libSBML with Python bindings for SBML support&quot;</span>


    <span class="c"># load options</span>
    <span class="n">fbc_version</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">VALIDATE</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">compress_bounds</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s">&#39;fbc_version&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span><span class="p">:</span>
        <span class="n">fbc_version</span> <span class="o">=</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;fbc_version&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;validate&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span><span class="p">:</span>
        <span class="n">VALIDATE</span> <span class="o">=</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;validate&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;compress_bounds&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span> <span class="ow">and</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">compress_bounds</span> <span class="o">=</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;compress_bounds&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">autofix</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">INFO: using FBC version: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fbc_version</span><span class="p">))</span>

    <span class="k">if</span>  <span class="n">fba</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">]:</span>
        <span class="c">##fba.setName(&#39;cbmpy_fbc_v{}_model&#39;.format(fbc_version))</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s">&#39;cbmpy_fbc_model&#39;</span><span class="p">)</span>
    <span class="n">fba</span><span class="o">.</span><span class="n">setModifiedDate</span><span class="p">()</span>

    <span class="n">USE_GROUPS</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">add_groups</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="s">&#39;groups&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fba</span><span class="o">.</span><span class="n">groups</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">USE_GROUPS</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">cs3</span> <span class="o">=</span> <span class="n">CBMtoSBML3</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fbc_version</span><span class="p">,</span> <span class="n">fbc_strict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">enable_groups</span><span class="o">=</span><span class="n">USE_GROUPS</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cs3</span><span class="o">.</span><span class="n">addBoundsV1</span><span class="p">(</span><span class="n">autofix</span><span class="o">=</span><span class="n">autofix</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">cs3</span><span class="o">.</span><span class="n">addBoundsV2</span><span class="p">(</span><span class="n">compress_bounds</span><span class="o">=</span><span class="n">compress_bounds</span><span class="p">)</span>

    <span class="n">cs3</span><span class="o">.</span><span class="n">addObjectives</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cs3</span><span class="o">.</span><span class="n">addGeneProteinAssociationsV1</span><span class="p">(</span><span class="n">parse_from_annotation</span><span class="o">=</span><span class="n">gpr_from_annot</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span>\
                                         <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="n">add_cbmpy_annot</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fbc_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">cs3</span><span class="o">.</span><span class="n">addGenesV2</span><span class="p">(</span><span class="n">parse_from_annotation</span><span class="o">=</span><span class="n">gpr_from_annot</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span>\
                       <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="n">add_cbmpy_annot</span><span class="p">)</span>

    <span class="c"># create a model</span>
    <span class="n">sbml_setDescription</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">)</span>
    <span class="n">sbml_setUnits</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">L3</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sbml_setSpeciesL3</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">add_cobra_anno</span><span class="o">=</span><span class="n">add_cobra_annot</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="n">add_cbmpy_annot</span><span class="p">,</span> <span class="n">substance_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sbml_setCompartmentsL3</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">fba</span><span class="p">)</span>
    <span class="n">sbml_setReactionsL3Fbc</span><span class="p">(</span><span class="n">cs3</span><span class="p">,</span> <span class="n">fba</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">add_cobra_anno</span><span class="o">=</span><span class="n">add_cobra_annot</span><span class="p">,</span> <span class="n">add_cbmpy_anno</span><span class="o">=</span><span class="n">add_cbmpy_annot</span><span class="p">,</span> <span class="n">fbc_version</span><span class="o">=</span><span class="n">fbc_version</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">USE_GROUPS</span><span class="p">:</span>
        <span class="n">sbml_setGroupsL3</span><span class="p">(</span><span class="n">cs3</span><span class="p">,</span> <span class="n">fba</span><span class="p">)</span>

    <span class="c"># stop libSBML deleting all my annotations</span>
    <span class="n">cs3</span><span class="o">.</span><span class="n">addModelHistory</span><span class="p">()</span>
    <span class="n">cs3</span><span class="o">.</span><span class="n">addModelAnnotation</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">directory</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s"> does not exist.&#39;</span> <span class="o">%</span> <span class="n">directory</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span> <span class="n">UseR</span> <span class="o">=</span> <span class="n">getuser</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">UseR</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c">#raw_input(&#39;L%sV%s&#39; % (document.getLevel(),document.getVersion()))</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">h1</span> <span class="o">+=</span> <span class="s">&#39;&lt;!-- SBML created with CBMPy (&#39;</span><span class="o">+</span> <span class="n">__version__</span> <span class="o">+</span> <span class="s">&#39;) on &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; --&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">h1</span> <span class="o">+</span> <span class="n">cs3</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">toSBML</span><span class="p">())</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">VALIDATE</span><span class="p">:</span>
        <span class="n">sbml_setValidationOptions</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Performing validation on output SBML ...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">DOCUMENT_VALID</span> <span class="o">=</span> <span class="n">sbml_validateDocument</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">fullmsg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">DOCUMENT_VALID</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">SBML document is invalid: filename will be {}.invalid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s">&#39;.invalid&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sbml_setValidationOptions</span><span class="p">(</span><span class="n">cs3</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Model exported as: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="n">cs3</span><span class="o">.</span><span class="n">_cleanUP_</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">cs3</span>
</div>
<div class="viewcode-block" id="sbml_setValidationOptions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setValidationOptions">[docs]</a><span class="k">def</span> <span class="nf">sbml_setValidationOptions</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    set the validation level of an SBML document</span>

<span class="sd">     - *D* an SBML document</span>
<span class="sd">     - *level* the level of consistency check can be either one of:</span>

<span class="sd">      - &#39;normal&#39; basic id checking only</span>
<span class="sd">      - &#39;full&#39; all checks enabled</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s">&#39;normal&#39;</span><span class="p">:</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_GENERAL_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_IDENTIFIER_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_UNITS_CONSISTENCY</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_MATHML_CONSISTENCY</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_SBO_CONSISTENCY</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_OVERDETERMINED_MODEL</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_MODELING_PRACTICE</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="s">&#39;full&#39;</span><span class="p">:</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_GENERAL_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_IDENTIFIER_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_UNITS_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_MATHML_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_SBO_CONSISTENCY</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_OVERDETERMINED_MODEL</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">D</span><span class="o">.</span><span class="n">setConsistencyChecks</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_CAT_MODELING_PRACTICE</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sbml_readCOBRASBML"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_readCOBRASBML">[docs]</a><span class="k">def</span> <span class="nf">sbml_readCOBRASBML</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_sbml_model</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">delete_intermediate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fake_boundary_species_search</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">speciesAnnotationFix</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a COBRA format SBML Level 2 file with FBA annotation where and return either a CBM model object</span>
<span class="sd">    or a (cbm_mod, sbml_mod) pair if return_sbml_model=True</span>

<span class="sd">     - *fname* is the filename</span>
<span class="sd">     - *work_dir* is the working directory</span>
<span class="sd">     - *return_sbml_model* [default=False] return a a (cbm_mod, sbml_mod) pair</span>
<span class="sd">     - *delete_intermediate* [default=False] delete the intermediate SBML Level 3 FBC file</span>
<span class="sd">     - *fake_boundary_species_search* [default=False] after looking for the boundary_condition of a species search for overloaded id&#39;s &lt;id&gt;_b</span>
<span class="sd">     - *output_dir* [default=None] the directory to output the intermediate SBML L3 files (if generated) default to input directory</span>
<span class="sd">     - *speciesAnnotationFix* [default=True]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_file</span> <span class="o">=</span> <span class="n">sbml_convertCOBRASBMLtoFBC</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">COBRA file conversion failed:</span><span class="se">\n\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">why</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sbml_readSBML3FBC</span><span class="p">(</span><span class="n">new_file</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">return_sbml_model</span><span class="o">=</span><span class="n">return_sbml_model</span><span class="p">,</span> <span class="n">xoptions</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;nogenes&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">fake_boundary_species_search</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_sbml_model</span><span class="p">:</span>
            <span class="n">cmod</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmod</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="n">cmod</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">s_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sid</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_b&#39;</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: Fake boundary (_b) metabolite fixed: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
                <span class="n">s_</span><span class="o">.</span><span class="n">setBoundary</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">speciesAnnotationFix</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_sbml_model</span><span class="p">:</span>
            <span class="n">cmod</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmod</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="n">cmod</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">processSpeciesChargeChemFormulaAnnot</span><span class="p">(</span><span class="n">s_</span><span class="p">,</span> <span class="n">getFromName</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">overwriteCharge</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteChemFormula</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;processSpeciesChargeChemFormulaAnnot failed for species with id: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()))</span>
        <span class="n">sbml_writeSBML3FBC</span><span class="p">(</span><span class="n">cmod</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">new_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">delete_intermediate</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">INFO: SBML Level 3 + FBC file generated as: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_file</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>


</div>
<div class="viewcode-block" id="sbml_convertCOBRASBMLtoFBC"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_convertCOBRASBMLtoFBC">[docs]</a><span class="k">def</span> <span class="nf">sbml_convertCOBRASBMLtoFBC</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a COBRA SBML Level 2 file and return the name of the created SBML Level 3 with FBC</span>
<span class="sd">    file that is created in the output directory</span>

<span class="sd">     - *fname* is the filename</span>
<span class="sd">     - *outname* the name of the output file. If not specified then &lt;filename&gt;.l3fbc.xml is used as default</span>
<span class="sd">     - *work_dir* [default=None] is the working directory</span>
<span class="sd">     - *output_dir* [default=None] is the output directory (default is work_dir)</span>

<span class="sd">    This method is based on code from libSBML (http://sbml.org) in the file &quot;convertCobra.py&quot;</span>
<span class="sd">    written by Frank T. Bergmann.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">ERROR: SBML not available ... install libSBML 5.8.0 r newer with Python bindings for SBML (http://sbml.org/Downloads)&quot;</span>
    <span class="k">assert</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_VERSION</span> <span class="o">&gt;=</span> <span class="mi">50800</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">WARNING: COBRA SBML import requires libSBML 5.8.0 or newer (your version: {}) (http://sbml.org/Downloads)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_VERSION</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fname_only</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">fname_only</span> <span class="o">=</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">output_dir</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">work_dir</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">ERROR: file </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s"> does not exist&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outname</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newfname</span> <span class="o">=</span> <span class="n">outname</span>
    <span class="c">#elif fname[-4:] == &#39;.xml&#39;:</span>
        <span class="c">#newfname = fname_only.replace(&#39;.xml&#39;, &#39;.l3fbc.xml&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newfname</span> <span class="o">=</span> <span class="n">fname_only</span><span class="o">+</span><span class="s">&#39;.l3fbc.xml&#39;</span>

    <span class="n">newfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">newfname</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">work_dir: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;output_dir: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;fname: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;newfname: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newfname</span><span class="p">))</span>


    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Read ...&#39;</span><span class="p">)</span>
    <span class="n">sbmldoc</span> <span class="o">=</span> <span class="n">SBMLreader</span><span class="o">.</span><span class="n">readSBML</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Read reports {} errors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sbmldoc</span><span class="o">.</span><span class="n">getNumErrors</span><span class="p">()))</span>
    <span class="c"># debug stuff</span>
    <span class="c">#M = sbmldoc.getModel()</span>
    <span class="c">#for s_ in range(M.getNumSpecies()):</span>
        <span class="c">#s = M.getSpecies(s_)</span>
        <span class="c">#s.unsetAnnotation()</span>
        <span class="c">#s.unsetNotes()</span>
    <span class="c">#for r_ in range(M.getNumReactions()):</span>
        <span class="c">#r = M.getReaction(r_)</span>
        <span class="c">#r.unsetAnnotation()</span>
        <span class="c">#r.unsetNotes()</span>

    <span class="k">if</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getNumErrors</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getErrorId</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLFileUnreadable</span><span class="p">:</span>
            <span class="c"># Handle case of unreadable file here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getErrorId</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLFileOperationError</span><span class="p">:</span>
            <span class="c"># Handle case of other file error here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Handle other error cases here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">ConversionProperties</span><span class="p">()</span>
    <span class="n">props</span><span class="o">.</span><span class="n">addOption</span><span class="p">(</span><span class="s">&quot;convert cobra&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;convert cobra sbml to fbc&quot;</span><span class="p">)</span>
    <span class="c">#props.addOption(&quot;ignorePackages&quot;, True, &quot;convert even if packages are used&quot;)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Convert ...&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Convert returns result {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;[Error] Conversion failed... (</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">SBMLwriter</span><span class="o">.</span><span class="n">writeSBML</span><span class="p">(</span><span class="n">sbmldoc</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newfname</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">INFO: successfully converted file {} to {}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newfname</span><span class="p">))</span>
    <span class="n">props</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">del</span> <span class="n">sbmldoc</span>
    <span class="n">sbmldoc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">newfname</span>
</div>
<div class="viewcode-block" id="sbml_convertSBML3FBCToCOBRA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_convertSBML3FBCToCOBRA">[docs]</a><span class="k">def</span> <span class="nf">sbml_convertSBML3FBCToCOBRA</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a SBML Level 3 file and return the name of the created COBRA</span>
<span class="sd">    file that is created in the output directory</span>

<span class="sd">     - *fname* is the filename</span>
<span class="sd">     - *outname* the name of the output file. If not specified then &lt;filename&gt;.cobra.xml is used as default</span>
<span class="sd">     - *work_dir* [default=None] is the working directory</span>
<span class="sd">     - *output_dir* [default=None] is the output directory (default is work_dir)</span>

<span class="sd">    This method is based on code from libSBML (http://sbml.org) in the file &quot;convertFbcToCobra.py&quot;</span>
<span class="sd">    written by Frank T. Bergmann.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">ERROR: SBML not available ... install libSBML 5.8.0 r newer with Python bindings for SBML (http://sbml.org/Downloads)&quot;</span>
    <span class="k">assert</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_VERSION</span> <span class="o">&gt;=</span> <span class="mi">50800</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">WARNING: COBRA SBML import requires libSBML 5.8.0 or newer (your version: {}) (http://sbml.org/Downloads)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_VERSION</span><span class="p">)</span>

    <span class="c">#global SBMLreader, SBMLwriter</span>


    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fname_only</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">fname_only</span> <span class="o">=</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">output_dir</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">work_dir</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">ERROR: file </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s"> does not exist&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outname</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newfname</span> <span class="o">=</span> <span class="n">outname</span>
    <span class="c">#elif fname[-4:] == &#39;.xml&#39;:</span>
        <span class="c">#newfname = fname_only.replace(&#39;.xml&#39;, &#39;.l3fbc.xml&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newfname</span> <span class="o">=</span> <span class="n">fname_only</span><span class="o">+</span><span class="s">&#39;.cobra.xml&#39;</span>

    <span class="n">newfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">newfname</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">work_dir: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;output_dir: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;fname: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;newfname: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newfname</span><span class="p">))</span>

    <span class="c">#SBMLreader  = libsbml.SBMLReader()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Read ...&#39;</span><span class="p">)</span>
    <span class="n">sbmldoc</span> <span class="o">=</span> <span class="n">SBMLreader</span><span class="o">.</span><span class="n">readSBML</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Read reports {} errors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sbmldoc</span><span class="o">.</span><span class="n">getNumErrors</span><span class="p">()))</span>
    <span class="c"># debug stuff</span>
    <span class="c">#M = sbmldoc.getModel()</span>
    <span class="c">#for s_ in range(M.getNumSpecies()):</span>
        <span class="c">#s = M.getSpecies(s_)</span>
        <span class="c">#s.unsetAnnotation()</span>
        <span class="c">#s.unsetNotes()</span>
    <span class="c">#for r_ in range(M.getNumReactions()):</span>
        <span class="c">#r = M.getReaction(r_)</span>
        <span class="c">#r.unsetAnnotation()</span>
        <span class="c">#r.unsetNotes()</span>

    <span class="k">if</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getNumErrors</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getErrorId</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLFileUnreadable</span><span class="p">:</span>
            <span class="c"># Handle case of unreadable file here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getErrorId</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLFileOperationError</span><span class="p">:</span>
            <span class="c"># Handle case of other file error here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Handle other error cases here.</span>
            <span class="n">sbmldoc</span><span class="o">.</span><span class="n">printErrors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">props</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">ConversionProperties</span><span class="p">()</span>
    <span class="n">props</span><span class="o">.</span><span class="n">addOption</span><span class="p">(</span><span class="s">&quot;convert fbc to cobra&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;Convert FBC model to Cobra model&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Convert ...&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sbmldoc</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Convert returns result {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;[Error] Conversion failed... (</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">SBMLwriter</span><span class="o">.</span><span class="n">writeSBML</span><span class="p">(</span><span class="n">sbmldoc</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newfname</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">INFO: successfully converted file {} to {}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newfname</span><span class="p">))</span>
    <span class="k">del</span> <span class="n">sbmldoc</span>
    <span class="k">return</span> <span class="n">newfname</span>
</div>
<div class="viewcode-block" id="sbml_validateDocument"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_validateDocument">[docs]</a><span class="k">def</span> <span class="nf">sbml_validateDocument</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">fullmsg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates and SBML document returns three dictionaries, errors, warnings, other and a boolean indicating an invalid document:</span>

<span class="sd">     - *D* and SBML document</span>
<span class="sd">     - *fullmsg* [default=False] optionally display the full error message</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">warnings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">others</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">DOCUMENT_VALID</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">e</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">e_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">validateSBML</span><span class="p">()):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="n">e_</span><span class="p">)</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">getErrorId</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;line&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">getLine</span><span class="p">()],</span>
               <span class="s">&#39;msg&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">getShortMessage</span><span class="p">(),</span>
               <span class="s">&#39;fullmsg&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">getMessage</span><span class="p">(),</span>
               <span class="s">&#39;severity_int&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">getSeverity</span><span class="p">(),</span>
               <span class="s">&#39;package&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">getPackage</span><span class="p">(),</span>
               <span class="s">&#39;severity&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">getSeverityAsString</span><span class="p">(),</span>
               <span class="s">&#39;isfatal&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">isFatal</span><span class="p">(),</span>
               <span class="s">&#39;isxml&#39;</span> <span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">isXML</span><span class="p">()</span>
               <span class="p">}</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;isfatal&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;isfatal&#39;</span><span class="p">]:</span>
            <span class="n">DOCUMENT_VALID</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">isError</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">errors</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]:</span>
                    <span class="n">errors</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">isWarning</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
                <span class="n">warnings</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]:</span>
                    <span class="n">warnings</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
                <span class="n">others</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">others</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]:</span>
                    <span class="n">others</span><span class="p">[</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">e</span>

    <span class="n">not_relevant</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20221</span><span class="p">,</span> <span class="mi">20616</span><span class="p">,</span> <span class="mi">80601</span><span class="p">,</span> <span class="mi">99130</span><span class="p">,</span> <span class="mi">99508</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">er</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">er</span> <span class="ow">in</span> <span class="n">not_relevant</span><span class="p">:</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NAtoFBC&#39;</span>
        <span class="k">elif</span> <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">fullmsg</span><span class="p">:</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;fullmsg&#39;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">er</span><span class="p">][</span><span class="s">&#39;fullmsg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Validation report:</span><span class="se">\n</span><span class="s">==================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Errors</span><span class="se">\n</span><span class="s">------</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">eidx</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e_</span> <span class="ow">in</span> <span class="n">eidx</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error {} (severity={}):</span><span class="se">\n\n</span><span class="s"> - {}</span><span class="se">\n</span><span class="s"> - lines: {}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_</span><span class="p">,</span> <span class="n">errors</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;severity&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;msg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Warnings</span><span class="se">\n</span><span class="s">--------</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">warnings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">eidx</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e_</span> <span class="ow">in</span> <span class="n">eidx</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Warning {} (severity={}):</span><span class="se">\n\n</span><span class="s"> - {}</span><span class="se">\n</span><span class="s"> - lines: {}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_</span><span class="p">,</span> <span class="n">warnings</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;severity&#39;</span><span class="p">],</span> <span class="n">warnings</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;msg&#39;</span><span class="p">],</span> <span class="n">warnings</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Other</span><span class="se">\n</span><span class="s">-----</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">eidx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">others</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">eidx</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e_</span> <span class="ow">in</span> <span class="n">eidx</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Info {} (severity={}):</span><span class="se">\n\n</span><span class="s"> - {}</span><span class="se">\n</span><span class="s"> - lines: {}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_</span><span class="p">,</span> <span class="n">others</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;severity&#39;</span><span class="p">],</span> <span class="n">others</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;msg&#39;</span><span class="p">],</span> <span class="n">others</span><span class="p">[</span><span class="n">e_</span><span class="p">][</span><span class="s">&#39;line&#39;</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;End.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">DOCUMENT_VALID</span>

</div>
<div class="viewcode-block" id="setCBSBOterm"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.setCBSBOterm">[docs]</a><span class="k">def</span> <span class="nf">setCBSBOterm</span><span class="p">(</span><span class="n">sbo</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given an SBOterm from libSBML, add it to a CBMPy object</span>

<span class="sd">     - *sbo* the sbo term string</span>
<span class="sd">     - *obj* the CBMPy Fbase derived object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sbo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">sbo</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">setSBOterm</span><span class="p">(</span><span class="n">sbo</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: {} is not a valid SBO term and is being ignored.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sbo</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sbml_readSBML3FBC"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_readSBML3FBC">[docs]</a><span class="k">def</span> <span class="nf">sbml_readSBML3FBC</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">return_sbml_model</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xoptions</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in an SBML Level 3 file with FBC annotation where and return either a CBM model object</span>
<span class="sd">    or a (cbm_mod, sbml_mod) pair if return_sbml_model=True</span>

<span class="sd">     - *fname* is the filename</span>
<span class="sd">     - *work_dir* is the working directory</span>
<span class="sd">     - *return_sbml_model* [default=False] return a a (cbm_mod, sbml_mod) pair</span>
<span class="sd">     - *xoptions* special load options enable with option = True</span>
<span class="sd">       - *nogenes* do not load/process genes</span>
<span class="sd">       - *noannot* do not load/process any annotations</span>
<span class="sd">       - *validate* validate model and display errors and warnings before loading</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time00</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">_HAVE_SBML_</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SBML not available ... install libSBML with Python bindings for SBML support&quot;</span>

    <span class="c"># load options</span>
    <span class="n">LOADGENES</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">LOADANNOT</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">VALIDATE</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s">&#39;nogenes&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span> <span class="ow">and</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;nogenes&#39;</span><span class="p">]:</span>
        <span class="n">LOADGENES</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">GPR loading disabled!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;noannot&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span> <span class="ow">and</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;noannot&#39;</span><span class="p">]:</span>
        <span class="n">LOADANNOT</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Annotation loading disabled!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;debug&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span> <span class="ow">and</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">]:</span>
        <span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Debug enabled!</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;validate&#39;</span> <span class="ow">in</span> <span class="n">xoptions</span> <span class="ow">and</span> <span class="n">xoptions</span><span class="p">[</span><span class="s">&#39;validate&#39;</span><span class="p">]:</span>
        <span class="n">VALIDATE</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># DEBUFG</span>
    <span class="c">#global D, M, FBCplg, SBRe, PARAM_D, RFBCplg, GENE_D, GPR_D, FB_data, GPRASSOC</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">readSBMLFromFile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">readSBMLFromFile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>

    <span class="c"># set consistency checking level for document</span>

    <span class="k">if</span> <span class="n">VALIDATE</span><span class="p">:</span>
        <span class="n">sbml_setValidationOptions</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Performing validation on input SBML ...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">DOCUMENT_VALID</span> <span class="o">=</span> <span class="n">sbml_validateDocument</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">DOCUMENT_VALID</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Validation has detected an invalid SBML document&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sbml_setValidationOptions</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">M</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">Invalid SBML file&quot;</span>
    <span class="k">assert</span> <span class="n">M</span><span class="o">.</span><span class="n">getLevel</span><span class="p">()</span> <span class="o">&gt;=</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">M</span><span class="o">.</span><span class="n">getVersion</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">An SBML L3V1 or greater model is required&quot;</span>

    <span class="c">## we are now going to allow loading non-FBC models (just to be friendly)</span>
    <span class="n">HAVE_FBC</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">libsbml</span><span class="p">,</span> <span class="s">&#39;Objective&#39;</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">SBML FBC package required, see http://sbml.org/Documents/Specifications/SBML_Level_3/Packages/Flux_Balance_Constraints_</span><span class="si">%28f</span><span class="s">lux%29 for more details.&quot;</span><span class="p">)</span>
        <span class="n">HAVE_FBC</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="n">FBCplg</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;fbc&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">FBCplg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">HAVE_FBC</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Model is not an SBML3 FBC model.</span><span class="se">\n</span><span class="s">Please try cbmpy.readCOBRASBML(</span><span class="se">\&#39;</span><span class="s">{}</span><span class="se">\&#39;</span><span class="s">) for models encoded in the COBRA dialect</span><span class="se">\n</span><span class="s">or cbmpy.readSBML2FBA(</span><span class="se">\&#39;</span><span class="s">{}</span><span class="se">\&#39;</span><span class="s">) for models in FAME format.</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
        <span class="c">#return None</span>

    <span class="n">FBCver</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">FBCstrict</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="n">FBCver</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getPackageVersion</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">FBCstrict</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getStrict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">FBCstrict</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">WARNING!!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;This model has fbc:strict=</span><span class="se">\&quot;</span><span class="s">false</span><span class="se">\&quot;</span><span class="s"> this means that is not necessarily a linear program and may contain a number of unsupported features containing aribtrary mathematical expressions such as, InitialAssignments, Rules, Events etc.&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">CBMPy can continue to load this model but will treat it as a convex linear problem and only load what it can interpret.&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">WARNING!!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Do you wish to continue (Y/N): &#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Y&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># print some model information</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC version: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FBCver</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;M.getNumReactions: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumReactions</span><span class="p">()))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;M.getNumSpecies: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumSpecies</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC.getNumObjectives: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumObjectives</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC.getNumGeneAssociations: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumGeneAssociations</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC.getNumFluxBounds: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumFluxBounds</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC.getNumParameters: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumParameters</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;FBC.getNumGeneProducts: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumGeneProducts</span><span class="p">()))</span>

    <span class="n">model_id</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
    <span class="n">model_description</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNotes</span><span class="p">())</span>
    <span class="n">model_description</span> <span class="o">=</span> <span class="n">xml_stripTags</span><span class="p">(</span><span class="n">model_description</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">__HAVE_FBA_ANOT_GENEASS__</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumFluxBounds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumObjectives</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumGeneAssociations</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">__HAVE_FBA_ANOT_GENEASS__</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">__HAVE_FBA_ANOT_OBJ__</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">__HAVE_FBA_ANOT_BNDS__</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">__HAVE_FBA_ANOT_GENEASS__</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">SPEC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumSpecies</span><span class="p">()):</span>
        <span class="n">SBSp</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">boundCon</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getBoundaryCondition</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Real boundary metabolite: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="n">boundCon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">CF</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># chemical formula</span>
        <span class="n">CH</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
            <span class="n">SBSpF</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&quot;fbc&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">SBSpF</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">CF</span> <span class="o">=</span> <span class="n">SBSpF</span><span class="o">.</span><span class="n">getChemicalFormula</span><span class="p">()</span>
                <span class="n">CH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SBSpF</span><span class="o">.</span><span class="n">getCharge</span><span class="p">())</span>
            <span class="c">#print CF, CH</span>

        <span class="n">NM</span> <span class="o">=</span> <span class="n">SBSp</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="c"># get name</span>
        <span class="c"># to strip a BiGG file see CBTools</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Species</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">boundary</span><span class="o">=</span><span class="n">boundCon</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">NM</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getInitialConcentration</span><span class="p">(),</span> <span class="n">compartment</span><span class="o">=</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getCompartment</span><span class="p">(),</span> <span class="n">charge</span><span class="o">=</span><span class="n">CH</span><span class="p">,</span> <span class="n">chemFormula</span><span class="o">=</span><span class="n">CF</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">annotation</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="n">S</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readCOBRANote</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getNotes</span><span class="p">()))</span>
            <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBSp</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">S</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
            <span class="k">del</span> <span class="n">manot</span>
        <span class="n">setCBSBOterm</span><span class="p">(</span><span class="n">SBSp</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">(),</span> <span class="n">S</span><span class="p">)</span>
        <span class="n">SPEC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>

    <span class="n">boundary_species</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">]</span>
    <span class="n">spec_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Species load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># we&#39;ll now deal with global parameters even if they are not used</span>
    <span class="n">PARAM_D</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumParameters</span><span class="p">()):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="n">p_</span><span class="p">)</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">pdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">pid</span><span class="p">,</span>
                 <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span>
                 <span class="s">&#39;constant&#39;</span> <span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">getConstant</span><span class="p">(),</span>
                 <span class="s">&#39;sbo&#39;</span> <span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">(),</span>
                 <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                 <span class="s">&#39;annotation&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="s">&#39;association&#39;</span> <span class="p">:</span> <span class="p">[]</span>
                 <span class="p">}</span>
        <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
            <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manot</span>
            <span class="k">del</span> <span class="n">manot</span>
        <span class="n">PARAM_D</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdict</span>

    <span class="n">GENE_D</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumGeneProducts</span><span class="p">()):</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getGeneProduct</span><span class="p">(</span><span class="n">g_</span><span class="p">)</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="n">gdict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">gid</span><span class="p">,</span>
                     <span class="c">#&#39;value&#39; : G.getValue(),</span>
                     <span class="c">#&#39;constant&#39; : P.getConstant(),</span>
                     <span class="s">&#39;sbo&#39;</span> <span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">(),</span>
                     <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                     <span class="s">&#39;label&#39;</span> <span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">getLabel</span><span class="p">(),</span>
                     <span class="s">&#39;annotation&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                     <span class="p">}</span>
            <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
                <span class="n">gdict</span><span class="p">[</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
                <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">gdict</span><span class="p">[</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manot</span>
                <span class="k">del</span> <span class="n">manot</span>
            <span class="n">GENE_D</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdict</span>

    <span class="n">REAC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">FB_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">GPR_D</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reactionsReversability</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gprregex</span>  <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;\w+&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumReactions</span><span class="p">()):</span>
        <span class="n">SBRe</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">R_id</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># deal with new style fluxbounds</span>
            <span class="n">RFBCplg</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&#39;fbc&#39;</span><span class="p">)</span>
            <span class="n">lfbid</span> <span class="o">=</span> <span class="n">RFBCplg</span><span class="o">.</span><span class="n">getLowerFluxBound</span><span class="p">()</span>
            <span class="n">ufbid</span> <span class="o">=</span> <span class="n">RFBCplg</span><span class="o">.</span><span class="n">getUpperFluxBound</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lfbid</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">fbl</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;reaction&#39;</span> <span class="p">:</span> <span class="n">R_id</span><span class="p">,</span>
                       <span class="s">&#39;operation&#39;</span> <span class="p">:</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span>
                       <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
                       <span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="s">&#39;{}_lb&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R_id</span><span class="p">),</span>
                       <span class="s">&#39;parameter&#39;</span> <span class="p">:</span> <span class="n">lfbid</span><span class="p">,</span>
                       <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">],</span>
                       <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span>
                       <span class="s">&#39;sbo&#39;</span>  <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">],</span>
                       <span class="s">&#39;type&#39;</span> <span class="p">:</span> <span class="s">&#39;lower&#39;</span><span class="p">,</span>
                       <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                       <span class="p">}</span>
                <span class="n">PARAM_D</span><span class="p">[</span><span class="n">lfbid</span><span class="p">][</span><span class="s">&#39;association&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_id</span><span class="p">)</span>
                <span class="n">FB_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fbl</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lfbid</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">fbu</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;reaction&#39;</span> <span class="p">:</span> <span class="n">R_id</span><span class="p">,</span>
                       <span class="s">&#39;operation&#39;</span> <span class="p">:</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span>
                       <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span>
                       <span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="s">&#39;{}_ub&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R_id</span><span class="p">),</span>
                       <span class="s">&#39;parameter&#39;</span> <span class="p">:</span> <span class="n">ufbid</span><span class="p">,</span>
                       <span class="s">&#39;annotation&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">],</span>
                       <span class="s">&#39;miriam&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">],</span>
                       <span class="s">&#39;sbo&#39;</span>  <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">],</span>
                       <span class="s">&#39;type&#39;</span> <span class="p">:</span> <span class="s">&#39;upper&#39;</span><span class="p">,</span>
                       <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                       <span class="p">}</span>
                <span class="n">PARAM_D</span><span class="p">[</span><span class="n">ufbid</span><span class="p">][</span><span class="s">&#39;association&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_id</span><span class="p">)</span>
                <span class="n">FB_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fbu</span><span class="p">)</span>

            <span class="c"># deal with new gene associations (why larry why ...)</span>
            <span class="n">SBgpr</span> <span class="o">=</span> <span class="n">RFBCplg</span><span class="o">.</span><span class="n">getGeneProductAssociation</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">SBgpr</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">GPR_id</span> <span class="o">=</span> <span class="n">SBgpr</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">GPR_id</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">GPR_id</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">GPR_id</span> <span class="o">=</span> <span class="s">&#39;{}_gpr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R_id</span><span class="p">)</span>
                <span class="n">ass</span> <span class="o">=</span> <span class="n">SBgpr</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ass</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gpr_by_id&#39;</span> <span class="p">:</span> <span class="n">ass</span><span class="o">.</span><span class="n">toInfix</span><span class="p">()}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gpr_by_id&#39;</span> <span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;reaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R_id</span>

                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gene_ids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c">## dirty hack</span>
                <span class="c">#for g_ in re.findall(gprregex, GPR_D[GPR_id][&#39;gpr_by_id&#39;]):</span>
                    <span class="c">#g = g_.strip().replace(&#39;)&#39;,&#39;&#39;).replace(&#39;(&#39;,&#39;&#39;)</span>
                    <span class="c">#if g != &#39;and&#39; and g != &#39;or&#39;:</span>
                        <span class="c">#GPR_D[GPR_id][&#39;gene_ids&#39;].append(g)</span>
                <span class="c">## the smart way</span>
                <span class="k">if</span> <span class="n">SBgpr</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">sbml_getGeneRefs</span><span class="p">(</span><span class="n">SBgpr</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">(),</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gene_ids&#39;</span><span class="p">])</span>

                <span class="c">#GPR_D[GPR_id][&#39;gene_ids&#39;] = list(set(GPR_D[GPR_id][&#39;gene_ids&#39;]))</span>
                <span class="n">gene_ids_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gene_ids&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
                <span class="n">gene_ids_sorted</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_id&#39;</span><span class="p">]</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_id&#39;</span><span class="p">]</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gene_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">gene_ids_sorted</span><span class="p">:</span>
                    <span class="c">#print(GPR_D[GPR_id])</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">x_</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">])</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gpr_by_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">x_</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;gene_labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GENE_D</span><span class="p">[</span><span class="n">x_</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">])</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SBgpr</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
                    <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">SBgpr</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
                    <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBgpr</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">GPR_D</span><span class="p">[</span><span class="n">GPR_id</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manot</span>
                    <span class="k">del</span> <span class="n">manot</span>

        <span class="n">reagents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">reactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNumReactants</span><span class="p">()):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getReactant</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
            <span class="n">stoi</span> <span class="o">=</span> <span class="o">-</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReactant</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">()</span>
            <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stoi</span><span class="p">,</span><span class="n">spec</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">boundary_species</span><span class="p">:</span>
                <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNumProducts</span><span class="p">()):</span>
            <span class="n">spec2</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getProduct</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
            <span class="n">stoi2</span> <span class="o">=</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getProduct</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span><span class="o">.</span><span class="n">getStoichiometry</span><span class="p">()</span>
            <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stoi2</span><span class="p">,</span><span class="n">spec2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">spec2</span> <span class="ow">in</span> <span class="n">boundary_species</span><span class="p">:</span>
                <span class="n">EXREAC</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">SBRe</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">reversible</span><span class="o">=</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReversible</span><span class="p">())</span>
        <span class="n">reactionsReversability</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getReversible</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reagents</span><span class="p">:</span>
            <span class="n">rgtmp</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reagent</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">R</span><span class="o">.</span><span class="n">addReagent</span><span class="p">(</span><span class="n">rgtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">[</span><span class="n">spec_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reagent_of</span><span class="p">:</span>
                <span class="n">SPEC</span><span class="p">[</span><span class="n">spec_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">reagent_of</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">getPid</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">EXREAC</span><span class="p">:</span>
            <span class="n">R</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">R</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
            <span class="n">R</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
            <span class="c"># only dig for ancient annotation if not using V2</span>
            <span class="k">if</span> <span class="n">FBCver</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="n">R</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readCOBRANote</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">XMLNode_convertXMLNodeToString</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getNotes</span><span class="p">()))</span>
            <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBRe</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">R</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
            <span class="k">del</span> <span class="n">manot</span>
        <span class="n">setCBSBOterm</span><span class="p">(</span><span class="n">SBRe</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">(),</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">REAC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Reactions load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># define compartments</span>
    <span class="n">COMP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getNumCompartments</span><span class="p">()):</span>
        <span class="n">SBcmp</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getCompartment</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">SBcmp</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">SBcmp</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">SBcmp</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="c">#printl(&#39;WARNING: SBML IMPORT Compartment {} has no size, setting to 1.0&#39;.format(cid))</span>
            <span class="c">#size = 1.0</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">SBcmp</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">SBcmp</span><span class="o">.</span><span class="n">getSpatialDimensions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Zero dimension compartment detected: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span>
            <span class="c"># zero dimension compartments make no sense and are assumed to be L2 artifacts</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Compartment</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LOADANNOT</span><span class="p">:</span>
            <span class="n">C</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">SBcmp</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
            <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">SBcmp</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">C</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
            <span class="k">del</span> <span class="n">manot</span>
        <span class="n">setCBSBOterm</span><span class="p">(</span><span class="n">SBcmp</span><span class="o">.</span><span class="n">getSBOTermID</span><span class="p">(),</span> <span class="n">C</span><span class="p">)</span>
        <span class="n">COMP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">cid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">C</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Compartment load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># extract fluxbounds</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">FB_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fb_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumFluxBounds</span><span class="p">()):</span>
            <span class="n">SBFb</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getFluxBound</span><span class="p">(</span><span class="n">fb_</span><span class="p">)</span>
            <span class="n">fbd</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;reaction&#39;</span> <span class="p">:</span> <span class="n">SBFb</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(),</span>
                   <span class="s">&#39;operation&#39;</span> <span class="p">:</span> <span class="n">SBFb</span><span class="o">.</span><span class="n">getOperation</span><span class="p">(),</span>
                   <span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">SBFb</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
                   <span class="p">}</span>
            <span class="n">fb_id</span> <span class="o">=</span> <span class="n">SBFb</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fb_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
                <span class="n">fbd</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fb_id</span>
            <span class="n">FB_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fbd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;FluxBounds load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># determine bound type and set default bounds for unbound reactions</span>
    <span class="n">CONSTR</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">boundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">LboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">UboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">AboundReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">DefinedReactionIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">FB_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">DefinedReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cntr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;greater&#39;</span><span class="p">,</span><span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;lower&#39;</span>
                    <span class="n">LboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;less&#39;</span><span class="p">,</span><span class="s">&#39;lessEqual&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;upper&#39;</span>
                    <span class="n">UboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;equal&#39;</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">]:</span>
                    <span class="n">O</span> <span class="o">=</span> <span class="s">&#39;equal&#39;</span>
                    <span class="n">AboundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;{}_{}_bnd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">O</span><span class="p">)</span>

            <span class="n">FB</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]))</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">newId</span><span class="p">)</span>
            <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FB</span><span class="p">)</span>
            <span class="c">#printl(&#39;FBID: {}&#39;.format(newId))</span>
            <span class="n">cntr</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boundReactionIDs</span><span class="p">:</span>
                <span class="n">boundReactionIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">])</span>
        <span class="c"># undefined flux bounds are given infinite value</span>
        <span class="n">ubcntr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reactionIDs</span><span class="p">)):</span>
            <span class="c">##  print reactionIDs[J], reactionsReversability[J]</span>
            <span class="n">LBt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">UBt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ABt</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">DefinedReactionIDs</span><span class="p">:</span>
                <span class="n">LBt</span> <span class="o">=</span> <span class="n">UBt</span> <span class="o">=</span> <span class="n">ABt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LboundReactionIDs</span><span class="p">:</span>
                <span class="n">LBt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">UboundReactionIDs</span><span class="p">:</span>
                <span class="n">UBt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="ow">in</span> <span class="n">AboundReactionIDs</span><span class="p">:</span>
                <span class="n">ABt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">LBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">UBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not LBt and not UBt and not ABt&#39;</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reactionsReversability</span><span class="p">[</span><span class="n">J</span><span class="p">]:</span>
                    <span class="c">##  print &#39;Adding reversible&#39;</span>
                    <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">##  print &#39;Adding irreversible&#39;</span>
                    <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">LBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not LBt and not ABt&#39;</span>
                <span class="c">#print reactionIDs[J]</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lower&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Added new lower bound&#39;</span><span class="p">,</span> <span class="n">newId</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">UBt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ABt</span><span class="p">:</span>
                <span class="c">#print &#39;not UBt and not ABt&#39;</span>
                <span class="c"># print reactionIDs[J]</span>
                <span class="c">#newId = &#39;UC_%i&#39; % ubcntr</span>
                <span class="n">newId</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_bnd&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;upper&#39;</span><span class="p">)</span>
                <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">newId</span><span class="p">,</span> <span class="n">reactionIDs</span><span class="p">[</span><span class="n">J</span><span class="p">],</span> <span class="s">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="n">ubcntr</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c"># print &#39;Added new upper bound&#39;, newId</span>
    <span class="k">elif</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c">#CONSTR = []</span>
        <span class="k">for</span> <span class="n">bnd</span> <span class="ow">in</span> <span class="n">FB_data</span><span class="p">:</span>
            <span class="n">FB</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">bnd</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;operation&#39;</span><span class="p">],</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">__param__</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;parameter&#39;</span><span class="p">]</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">__sbo_term__</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span>
            <span class="n">FB</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">FB</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">FB</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">FB</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">bnd</span><span class="p">[</span><span class="s">&#39;parameter&#39;</span><span class="p">]</span>
            <span class="n">CONSTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FB</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;FluxBounds process: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c">#Create parameters</span>
    <span class="n">PARAM</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p_</span> <span class="ow">in</span> <span class="n">PARAM_D</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;value&#39;</span><span class="p">],</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;constant&#39;</span><span class="p">])</span>
        <span class="n">P</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
        <span class="n">P</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span>
        <span class="n">P</span><span class="o">.</span><span class="n">__sbo_term__</span> <span class="o">=</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span>
        <span class="n">P</span><span class="o">.</span><span class="n">_association_</span> <span class="o">=</span> <span class="n">PARAM_D</span><span class="p">[</span><span class="n">p_</span><span class="p">][</span><span class="s">&#39;association&#39;</span><span class="p">]</span>
        <span class="n">PARAM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Parameter process: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># try extract objective functions</span>
    <span class="n">OBJFUNCout</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ACTIVE_OBJ</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: Active objective:&#39;</span><span class="p">,</span> <span class="n">ACTIVE_OBJ</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">why</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">INFO: No active objective defined&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">of_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FBCplg</span><span class="o">.</span><span class="n">getNumObjectives</span><span class="p">()):</span>
            <span class="n">SBOf</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getObjective</span><span class="p">(</span><span class="n">of_</span><span class="p">)</span>
            <span class="n">OF</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">SBOf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">SBOf</span><span class="o">.</span><span class="n">getType</span><span class="p">())</span>
            <span class="n">OF</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">SBOf</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ofl_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SBOf</span><span class="o">.</span><span class="n">getNumFluxObjectives</span><span class="p">()):</span>
                <span class="n">SBOfl</span> <span class="o">=</span> <span class="n">SBOf</span><span class="o">.</span><span class="n">getFluxObjective</span><span class="p">(</span><span class="n">ofl_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">SBOfl</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]:</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_flobj&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SBOf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">SBOfl</span><span class="o">.</span><span class="n">getReaction</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">SBOf</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="n">Oflx</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxObjective</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">SBOfl</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="n">SBOfl</span><span class="o">.</span><span class="n">getCoefficient</span><span class="p">()))</span>
                <span class="n">Oflx</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">SBOfl</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
                <span class="n">OF</span><span class="o">.</span><span class="n">addFluxObjective</span><span class="p">(</span><span class="n">Oflx</span><span class="p">)</span>
            <span class="n">OBJFUNCout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OF</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;ObjectiveFunction load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">GPRASSOC</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">HAVE_FBC</span> <span class="ow">and</span> <span class="n">LOADGENES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">__HAVE_FBA_ANOT_GENEASS__</span><span class="p">:</span>
            <span class="n">SBGPR</span> <span class="o">=</span> <span class="n">FBCplg</span><span class="o">.</span><span class="n">getListOfGeneAssociations</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="n">SBGPR</span><span class="p">:</span>
                <span class="n">gprid</span> <span class="o">=</span> <span class="n">g_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                <span class="n">rid</span> <span class="o">=</span> <span class="n">g_</span><span class="o">.</span><span class="n">getReaction</span><span class="p">()</span>
                <span class="n">GPRASSOC</span><span class="p">[</span><span class="n">gprid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">g_</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">assoc</span> <span class="o">=</span> <span class="n">g_</span><span class="o">.</span><span class="n">getAssociation</span><span class="p">()</span><span class="o">.</span><span class="n">toInfix</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">assoc</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">assoc</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">GPRASSOC</span><span class="p">[</span><span class="n">gprid</span><span class="p">][</span><span class="s">&#39;reaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rid</span>
                        <span class="n">GPRASSOC</span><span class="p">[</span><span class="n">gprid</span><span class="p">][</span><span class="s">&#39;gpr_by_id&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">assoc</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;GPR load: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># build model</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">isSetMetaId</span><span class="p">():</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">__metaid__</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getMetaId</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">setMetaId</span><span class="p">(</span><span class="s">&#39;meta_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_id</span><span class="p">))</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">model_description</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">())</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">__FBC_STRICT__</span> <span class="o">=</span> <span class="n">FBCstrict</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">__FBC_VERSION__</span> <span class="o">=</span> <span class="n">FBCver</span>

    <span class="n">manot</span> <span class="o">=</span> <span class="n">sbml_getCVterms</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">manot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">manot</span>
    <span class="k">del</span> <span class="n">manot</span>

    <span class="n">fm</span><span class="o">.</span><span class="n">sourcefile</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="n">sbmh</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getModelHistory</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sbmh</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cdate</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getCreatedDate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cdate</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">cdate</span><span class="o">.</span><span class="n">getYear</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getMonth</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getDay</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getHour</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getMinute</span><span class="p">(),</span> <span class="n">cdate</span><span class="o">.</span><span class="n">getSecond</span><span class="p">())</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">setCreatedDate</span><span class="p">(</span><span class="n">cdate</span><span class="p">)</span>
        <span class="n">mdate</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getModifiedDate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mdate</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">mdate</span><span class="o">.</span><span class="n">getYear</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getMonth</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getDay</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getHour</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getMinute</span><span class="p">(),</span> <span class="n">mdate</span><span class="o">.</span><span class="n">getSecond</span><span class="p">())</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">setModifiedDate</span><span class="p">(</span><span class="n">mdate</span><span class="p">)</span>
        <span class="n">mCr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sbmh</span><span class="o">.</span><span class="n">getNumCreators</span><span class="p">()):</span>
            <span class="n">sbc</span> <span class="o">=</span> <span class="n">sbmh</span><span class="o">.</span><span class="n">getCreator</span><span class="p">(</span><span class="n">m_</span><span class="p">)</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addModelCreator</span><span class="p">(</span><span class="n">sbc</span><span class="o">.</span><span class="n">getGivenName</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getFamilyName</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getOrganisation</span><span class="p">(),</span> <span class="n">sbc</span><span class="o">.</span><span class="n">getEmail</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Model build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">co_</span> <span class="ow">in</span> <span class="n">COMP</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">co_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Compartment build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="n">SPEC</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addSpecies</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Species build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">REAC</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Reaction build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fbexists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="n">CONSTR</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">fbexists</span><span class="o">=</span><span class="n">fbexists</span><span class="p">)</span>
        <span class="n">fbexists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c_</span><span class="o">.</span><span class="n">getReactionId</span><span class="p">(),</span> <span class="n">c_</span><span class="o">.</span><span class="n">getType</span><span class="p">()))</span>
    <span class="k">del</span> <span class="n">fbexists</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;FluxBound build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">o_</span> <span class="ow">in</span> <span class="n">OBJFUNCout</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">o_</span><span class="o">.</span><span class="n">getPid</span><span class="p">()</span> <span class="o">==</span> <span class="n">ACTIVE_OBJ</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o_</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o_</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Objective build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p_</span> <span class="ow">in</span> <span class="n">PARAM</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span><span class="n">p_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Parameter build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">LOADGENES</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="n">GPRASSOC</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;reaction&#39;</span> <span class="ow">in</span> <span class="n">GPRASSOC</span><span class="p">[</span><span class="n">g_</span><span class="p">]:</span>
                <span class="n">fm</span><span class="o">.</span><span class="n">createGeneProteinAssociation</span><span class="p">(</span><span class="n">GPRASSOC</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">GPRASSOC</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;gpr_by_id&#39;</span><span class="p">],</span> <span class="n">gid</span><span class="o">=</span><span class="n">g_</span><span class="p">,</span> <span class="n">update_idx</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">__updateGeneIdx__</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">FBCver</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">LOADGENES</span><span class="p">:</span>
        <span class="c"># note we may want to add branches here for using indexes etc etc</span>
        <span class="n">non_gpr_genes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="n">GPR_D</span><span class="p">:</span>
            <span class="n">fm</span><span class="o">.</span><span class="n">createGeneProteinAssociation</span><span class="p">(</span><span class="n">GPR_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;reaction&#39;</span><span class="p">],</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;gpr_by_id&#39;</span><span class="p">],</span> <span class="n">gid</span><span class="o">=</span><span class="n">g_</span><span class="p">,</span> <span class="n">update_idx</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">gpr</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getGPRassociation</span><span class="p">(</span><span class="n">g_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gpr</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">gpr</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
                <span class="n">gpr</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span>
                <span class="n">gpr</span><span class="o">.</span><span class="n">__sbo_term__</span> <span class="o">=</span> <span class="n">GPR_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">__updateGeneIdx__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="n">GENE_D</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getGene</span><span class="p">(</span><span class="n">g_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">G</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">GENE_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">G</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
                <span class="n">G</span><span class="o">.</span><span class="n">__sbo_term__</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span>
                <span class="n">G</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">g_</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Gene {} is not part of a GPR association. Will create anyway!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">g_</span><span class="p">))</span>
                <span class="n">non_gpr_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g_</span><span class="p">)</span>
        <span class="c"># TODO: this is a corner case I&#39;ll deal with it better later, non GPR associated genes are added as inactive gene objects</span>
        <span class="k">for</span> <span class="n">ng_</span> <span class="ow">in</span> <span class="n">non_gpr_genes</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Gene</span><span class="p">(</span><span class="n">ng_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">GENE_D</span><span class="p">[</span><span class="n">ng_</span><span class="p">][</span><span class="s">&#39;label&#39;</span><span class="p">],</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">ng_</span><span class="p">][</span><span class="s">&#39;annotation&#39;</span><span class="p">]</span>
            <span class="n">G</span><span class="o">.</span><span class="n">__sbo_term__</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">ng_</span><span class="p">][</span><span class="s">&#39;sbo&#39;</span><span class="p">]</span>
            <span class="n">G</span><span class="o">.</span><span class="n">miriam</span> <span class="o">=</span> <span class="n">GENE_D</span><span class="p">[</span><span class="n">ng_</span><span class="p">][</span><span class="s">&#39;miriam&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;GPR build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">time0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c"># Groups support</span>
    <span class="n">HAVE_GROUPS</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">GRPplg</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getPlugin</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&quot;groups&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">GRPplg</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">HAVE_GROUPS</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">why</span><span class="p">))</span>
        <span class="n">GRPplg</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">HAVE_GROUPS</span> <span class="o">=</span> <span class="bp">False</span>


    <span class="k">if</span> <span class="n">HAVE_GROUPS</span> <span class="ow">and</span> <span class="n">GRPplg</span><span class="o">.</span><span class="n">getNumGroups</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Groups support: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GRPplg</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Group.getNumGroups: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GRPplg</span><span class="o">.</span><span class="n">getNumGroups</span><span class="p">()))</span>

        <span class="n">s_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">()</span>
        <span class="n">r_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
        <span class="n">c_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getCompartmentIds</span><span class="p">()</span>
        <span class="n">f_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getFluxBoundIds</span><span class="p">()</span>
        <span class="n">o_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getObjectiveIds</span><span class="p">()</span>
        <span class="n">g_ids</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getGeneIds</span><span class="p">()</span>
        <span class="n">grp_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">GRPplg</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">GRPplg</span><span class="o">.</span><span class="n">getNumGroups</span><span class="p">())]</span>

        <span class="c">#print(grp_ids)</span>
        <span class="n">sub_group_assoc</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">GRPplg</span><span class="o">.</span><span class="n">getNumGroups</span><span class="p">()):</span>
            <span class="n">GR</span> <span class="o">=</span> <span class="n">GRPplg</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">grp_id</span> <span class="o">=</span> <span class="n">GR</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Group</span><span class="p">(</span><span class="n">grp_id</span><span class="p">)</span>
            <span class="n">grp</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="n">grp</span><span class="o">.</span><span class="n">setKind</span><span class="p">(</span><span class="n">GROUP_KINDS</span><span class="p">[</span><span class="n">GR</span><span class="o">.</span><span class="n">getKind</span><span class="p">()])</span>
            <span class="k">if</span> <span class="n">GR</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">setSBOterm</span><span class="p">(</span><span class="s">&#39;SBO:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">())</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">7</span><span class="p">)))</span>

            <span class="n">notes</span> <span class="o">=</span> <span class="n">GR</span><span class="o">.</span><span class="n">getNotesString</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">notes</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">notes</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;html:body&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/html:body&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;notes&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/notes&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">setNotes</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>

            <span class="n">annostr</span> <span class="o">=</span> <span class="n">GR</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">annostr</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">annostr</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">annostr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">id:&#39;</span><span class="p">,</span> <span class="n">grp_id</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;name:&#39;</span><span class="p">,</span> <span class="n">GR</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;kind:&#39;</span><span class="p">,</span> <span class="n">GROUP_KINDS</span><span class="p">[</span><span class="n">GR</span><span class="o">.</span><span class="n">getKind</span><span class="p">()])</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;sboterm:&#39;</span><span class="p">,</span> <span class="s">&#39;SBO:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">())</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">7</span><span class="p">)))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;annotations:&#39;</span><span class="p">,</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;notes:&#39;</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>

            <span class="c"># TODO</span>
            <span class="c">#notes = libsbml.XMLNode_convertXMLNodeToString(GR.getNotes())</span>
            <span class="c">#notes = GR.getNotesString()</span>

            <span class="n">LOM</span> <span class="o">=</span> <span class="n">GR</span><span class="o">.</span><span class="n">getListOfMembers</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">LOM</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">setSharedSBOterm</span><span class="p">(</span><span class="s">&#39;SBO:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LOM</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">())</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">7</span><span class="p">)))</span>

            <span class="n">lom_notes</span> <span class="o">=</span> <span class="n">LOM</span><span class="o">.</span><span class="n">getNotesString</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lom_notes</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">lom_notes</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">lom_notes</span> <span class="o">=</span> <span class="n">lom_notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;html:body&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/html:body&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">lom_notes</span> <span class="o">=</span> <span class="n">lom_notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;notes&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/notes&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">setSharedNotes</span><span class="p">(</span><span class="n">lom_notes</span><span class="p">)</span>


            <span class="n">annostr</span> <span class="o">=</span> <span class="n">LOM</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">annostr</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">annostr</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">_member_attributes_</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">annostr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;sboterm (shared):&#39;</span><span class="p">,</span> <span class="s">&#39;SBO:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LOM</span><span class="o">.</span><span class="n">getSBOTerm</span><span class="p">())</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">7</span><span class="p">)))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;annotations (shared):&#39;</span><span class="p">,</span> <span class="n">sbml_readKeyValueDataAnnotation</span><span class="p">(</span><span class="n">LOM</span><span class="o">.</span><span class="n">getAnnotationString</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;notes (shared):&#39;</span><span class="p">,</span> <span class="n">lom_notes</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;num members:&#39;</span><span class="p">,</span> <span class="n">GR</span><span class="o">.</span><span class="n">getNumMembers</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getNumMembers</span><span class="p">()):</span>
                <span class="n">idr</span> <span class="o">=</span> <span class="n">GR</span><span class="o">.</span><span class="n">getMember</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">getIdRef</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">member idRef:&#39;</span><span class="p">,</span> <span class="n">GR</span><span class="o">.</span><span class="n">getMember</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">getIdRef</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">s_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">r_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">r_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">f_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">[</span><span class="n">f_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">g_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">genes</span><span class="p">[</span><span class="n">g_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">c_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">compartments</span><span class="p">[</span><span class="n">c_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">o_ids</span><span class="p">:</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">o_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idr</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="n">idr</span> <span class="ow">in</span> <span class="n">grp_ids</span><span class="p">:</span>
                    <span class="c">#print(idr)</span>
                    <span class="c">#print(grp_id)</span>
                    <span class="c"># scanning for subgroup members to assign later</span>
                    <span class="k">if</span> <span class="n">grp_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sub_group_assoc</span><span class="p">:</span>
                        <span class="n">sub_group_assoc</span><span class="p">[</span><span class="n">grp_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">idr</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sub_group_assoc</span><span class="p">[</span><span class="n">grp_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Skipping group </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s"> member </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">, it is an incompatible type.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GR</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">idr</span><span class="p">))</span>

            <span class="n">fm</span><span class="o">.</span><span class="n">addGroup</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">s_ids</span><span class="p">,</span> <span class="n">r_ids</span><span class="p">,</span> <span class="n">c_ids</span><span class="p">,</span> <span class="n">f_ids</span><span class="p">,</span> <span class="n">o_ids</span><span class="p">,</span> <span class="n">g_ids</span>

        <span class="c"># adding subgroups</span>
        <span class="k">for</span> <span class="n">grp_</span> <span class="ow">in</span> <span class="n">sub_group_assoc</span><span class="p">:</span>
            <span class="n">GRP</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">grp_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sg_</span> <span class="ow">in</span> <span class="n">sub_group_assoc</span><span class="p">[</span><span class="n">grp_</span><span class="p">]:</span>
                <span class="n">GRP</span><span class="o">.</span><span class="n">addMember</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">sg_</span><span class="p">))</span>
                <span class="c">#print(&#39;Adding: {} to {}&#39;.format(sg_, grp_))</span>
        <span class="c">#print(sub_group_assoc)</span>
        <span class="k">del</span> <span class="n">sub_group_assoc</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CONSTR</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: No FBC flux bounds were defined.&#39;</span><span class="p">)</span>
        <span class="c">#time.sleep(1)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">OBJFUNCout</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: No FBC objective functions were defined.&#39;</span><span class="p">)</span>
        <span class="c">#time.sleep(1)</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">_SBML_LEVEL_</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fm</span><span class="o">.</span><span class="n">buildStoichMatrix</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">why</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">INFO: unable to construct stoichiometric matrix&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;Nmatrix build: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;SBML3 load time: {}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time00</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>

    <span class="k">del</span> <span class="n">M</span><span class="p">,</span> <span class="n">D</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_sbml_model</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;SBML object return temporarily disabled&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fm</span><span class="p">,</span> <span class="bp">None</span>
</div>
<span class="n">re_html_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&lt;p&gt;.*?&lt;/p&gt;&quot;</span><span class="p">)</span>
<span class="n">re_html_cobra_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&lt;html:p&gt;.*?&lt;/html:p&gt;&quot;</span><span class="p">)</span>
<span class="n">re_html_span</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&lt;span&gt;.*?&lt;/span&gt;&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="sbml_readCOBRANote"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_readCOBRANote">[docs]</a><span class="k">def</span> <span class="nf">sbml_readCOBRANote</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses a COBRA style note from a XML string</span>

<span class="sd">     - *s* an XML string</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_ann</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cobra_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_html_cobra_p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">html_c_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_html_p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cobra_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">cobra_p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cobra_p</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;html:p&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/html:p&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">html_c_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">cobra_p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">html_c_p</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;p&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/p&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
    <span class="k">elif</span> <span class="s">&#39;&lt;span xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_html_p</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">re_html_span</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;span&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
    <span class="c">#print new_ann</span>
    <span class="k">return</span> <span class="n">new_ann</span>

</div>
<span class="n">BQ2CBMMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">8</span>  <span class="p">:</span> <span class="s">&quot;encodes&quot;</span><span class="p">,</span>
    <span class="mi">1</span>  <span class="p">:</span> <span class="s">&quot;hasPart&quot;</span><span class="p">,</span>
    <span class="mi">10</span> <span class="p">:</span> <span class="s">&quot;hasProperty&quot;</span><span class="p">,</span>
    <span class="mi">4</span>  <span class="p">:</span> <span class="s">&quot;hasVersion&quot;</span><span class="p">,</span>
    <span class="mi">0</span>  <span class="p">:</span> <span class="s">&quot;is&quot;</span><span class="p">,</span>
    <span class="mi">6</span>  <span class="p">:</span> <span class="s">&quot;isDescribedBy&quot;</span><span class="p">,</span>
    <span class="mi">7</span>  <span class="p">:</span> <span class="s">&quot;isEncodedBy&quot;</span><span class="p">,</span>
    <span class="mi">5</span>  <span class="p">:</span> <span class="s">&quot;isHomologTo&quot;</span><span class="p">,</span>
    <span class="mi">2</span>  <span class="p">:</span> <span class="s">&quot;isPartOf&quot;</span><span class="p">,</span>
    <span class="mi">11</span> <span class="p">:</span> <span class="s">&quot;isPropertyOf&quot;</span><span class="p">,</span>
    <span class="mi">3</span>  <span class="p">:</span> <span class="s">&quot;isVersionOf&quot;</span><span class="p">,</span>
    <span class="mi">9</span>  <span class="p">:</span> <span class="s">&quot;occursIn&quot;</span><span class="p">,</span>
    <span class="mi">12</span> <span class="p">:</span> <span class="bp">None</span>
<span class="p">}</span>

<span class="n">CBM2BQMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;encodes&quot;</span>       <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">&quot;hasPart&quot;</span>       <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&quot;hasProperty&quot;</span>   <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s">&quot;hasVersion&quot;</span>    <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s">&quot;is&quot;</span>            <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;isDescribedBy&quot;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s">&quot;isEncodedBy&quot;</span>   <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s">&quot;isHomologTo&quot;</span>   <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s">&quot;isPartOf&quot;</span>      <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;isPropertyOf&quot;</span>  <span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s">&quot;isVersionOf&quot;</span>   <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s">&quot;occursIn&quot;</span>      <span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="bp">None</span>            <span class="p">:</span> <span class="mi">12</span>
<span class="p">}</span>

<span class="n">BQM2CBMMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span>  <span class="p">:</span> <span class="s">&quot;is&quot;</span><span class="p">,</span>
    <span class="mi">1</span>  <span class="p">:</span> <span class="s">&quot;isDescribedBy&quot;</span><span class="p">,</span>
    <span class="mi">2</span>  <span class="p">:</span> <span class="s">&quot;isDerivedFrom&quot;</span><span class="p">,</span>
    <span class="mi">3</span> <span class="p">:</span> <span class="bp">None</span>
<span class="p">}</span>

<span class="n">CBM2BQMMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;is&quot;</span>            <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;isDescribedBy&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&quot;isDerivedFrom&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="bp">None</span>            <span class="p">:</span> <span class="mi">3</span>
<span class="p">}</span>


<div class="viewcode-block" id="sbml_getCVterms"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_getCVterms">[docs]</a><span class="k">def</span> <span class="nf">sbml_getCVterms</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the MIRIAM compliant CV terms and return a MIRIAMAnnotation or None</span>

<span class="sd">     - *sb* a libSBML SBase derived object</span>
<span class="sd">     - *model* is this a BQmodel term</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">sb</span><span class="o">.</span><span class="n">getNumCVTerms</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sb</span><span class="o">.</span><span class="n">getNumCVTerms</span><span class="p">()):</span>
            <span class="n">cvt</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">getCVTerm</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span>
            <span class="n">resrc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">cvt</span><span class="o">.</span><span class="n">getQualifierType</span><span class="p">()</span> <span class="o">==</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">BIOLOGICAL_QUALIFIER</span><span class="p">:</span>
                <span class="n">qual</span> <span class="o">=</span> <span class="n">BQ2CBMMAP</span><span class="p">[</span><span class="n">cvt</span><span class="o">.</span><span class="n">getBiologicalQualifierType</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qual</span> <span class="o">=</span> <span class="n">BQM2CBMMAP</span><span class="p">[</span><span class="n">cvt</span><span class="o">.</span><span class="n">getModelQualifierType</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cvt</span><span class="o">.</span><span class="n">getNumResources</span><span class="p">()):</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">cvt</span><span class="o">.</span><span class="n">getResourceURI</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">qual</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">uri</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">resrc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">qual</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">resrc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">man</span> <span class="o">=</span> <span class="n">MIRIAMannotation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">q_</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="n">q_</span><span class="p">]:</span>
                <span class="n">man</span><span class="o">.</span><span class="n">addIDorgURI</span><span class="p">(</span><span class="n">q_</span><span class="p">,</span> <span class="n">r_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">man</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="sbml_setCVterms"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBXML.sbml_setCVterms">[docs]</a><span class="k">def</span> <span class="nf">sbml_setCVterms</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">uridict</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add MIRIAM compliant CV terms to a sbml object from a CBM object</span>

<span class="sd">     - *sb* a libSBML SBase derived object</span>
<span class="sd">     - *uridict* a dictionary of uri&#39;s as produced by getAllMIRIAMUris()</span>
<span class="sd">     - *model* is this a BQmodel term [deprecated attribute, ignored and autodetected]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="n">uridict</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uridict</span><span class="p">[</span><span class="n">t_</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">global</span> <span class="n">cv</span>
            <span class="c">#print(t_)</span>
            <span class="c">#print(uridict[t_])</span>
            <span class="k">if</span> <span class="n">t_</span> <span class="ow">in</span> <span class="n">CBM2BQMAP</span><span class="p">:</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">CVTerm</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">BIOLOGICAL_QUALIFIER</span><span class="p">)</span>
                <span class="n">cv</span><span class="o">.</span><span class="n">setBiologicalQualifierType</span><span class="p">(</span><span class="n">CBM2BQMAP</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t_</span><span class="p">)])</span>
                <span class="c">#print(CBM2BQMAP[t_])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cv</span> <span class="o">=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">CVTerm</span><span class="p">(</span><span class="n">libsbml</span><span class="o">.</span><span class="n">MODEL_QUALIFIER</span><span class="p">)</span>
                <span class="n">cv</span><span class="o">.</span><span class="n">setModelQualifierType</span><span class="p">(</span><span class="n">CBM2BQMMAP</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t_</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">u_</span> <span class="ow">in</span> <span class="n">uridict</span><span class="p">[</span><span class="n">t_</span><span class="p">]:</span>
                <span class="c">#print(u_)</span>
                <span class="c">#print(uridict[t_])</span>
                <span class="k">if</span> <span class="n">cv</span><span class="o">.</span><span class="n">addResource</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">u_</span><span class="p">))</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO failure adding MIRIAM resource {} to: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_</span><span class="p">,</span> <span class="n">sb</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>

            <span class="k">if</span> <span class="n">sb</span><span class="o">.</span><span class="n">addCVTerm</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span> <span class="o">!=</span> <span class="n">libsbml</span><span class="o">.</span><span class="n">LIBSBML_OPERATION_SUCCESS</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;INFO: failure adding MIRIAM term: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sb</span><span class="o">.</span><span class="n">addCVTerm</span><span class="p">(</span><span class="n">cv</span><span class="p">)))</span>
</div>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">print libsbml.BQB_ENCODES            , 8  # &quot;encodes&quot;,</span>
<span class="sd">print libsbml.BQB_HAS_PART           , 1  # &quot;hasPart&quot;,</span>
<span class="sd">print libsbml.BQB_HAS_PROPERTY       , 10 # &quot;hasProperty&quot;,</span>
<span class="sd">print libsbml.BQB_HAS_VERSION        , 4  # &quot;hasVersion&quot;,</span>
<span class="sd">print libsbml.BQB_IS                 , 0  # &quot;isA&quot;,</span>
<span class="sd">print libsbml.BQB_IS_DESCRIBED_BY    , 6  # &quot;isDescribedBy&quot;,</span>
<span class="sd">print libsbml.BQB_IS_ENCODED_BY      , 7  # &quot;isEncodedBy&quot;,</span>
<span class="sd">print libsbml.BQB_IS_HOMOLOG_TO      , 5  # &quot;isHomologTo&quot;,</span>
<span class="sd">print libsbml.BQB_IS_PART_OF         , 2  # &quot;isPartOf&quot;,</span>
<span class="sd">print libsbml.BQB_IS_PROPERTY_OF     , 11 # &quot;isPropertyOf&quot;,</span>
<span class="sd">print libsbml.BQB_IS_VERSION_OF      , 3  # &quot;isVersionOf&quot;,</span>
<span class="sd">print libsbml.BQB_OCCURS_IN          , 9  # &quot;occursIn&quot;,</span>
<span class="sd">print libsbml.BQB_UNKNOWN            , 12 # None</span>

<span class="sd">print libsbml.BQM_IS                 , 0 # None</span>
<span class="sd">print libsbml.BQM_IS_DERIVED_FROM    , 2 # None</span>
<span class="sd">print libsbml.BQM_IS_DESCRIBED_BY    , 1 # None</span>
<span class="sd">print libsbml.BQM_UNKNOWN            , 3 # None</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2010-2016, Brett G. Olivier.
      Last updated on Feb 25, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>